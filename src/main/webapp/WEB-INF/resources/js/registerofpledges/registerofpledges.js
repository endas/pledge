
var frmApplicationUserDetailsCreateUpdateContactNameBuffer = null;

var frmApplicationUserDetailsCreateUpdateRepresentOrganisationTextBuffer = null;
var frmApplicationUserDetailsCreateUpdateRepresentOrganisationValueBuffer = 0;
var frmApplicationUserDetailsCreateUpdateRepresentOrganisationSetupCompleted = false;


var frmApplicationUserDetailsCreateUpdateOrganisationNameTextBuffer = null;
var frmApplicationUserDetailsCreateUpdateOrganisationNameValueBuffer = 0;
var frmApplicationUserDetailsCreateUpdateOrganisationNameCompleted = false;

var frmApplicationUserDetailsCreateUpdateTelephoneNumberBuffer = null;

var frmApplicationUserDetailsCreateUpdateAddressOneBuffer = null;

var frmApplicationUserDetailsCreateUpdateAddressTwoBuffer = null;

var frmApplicationUserDetailsCreateUpdateCityBuffer = null;

var frmApplicationUserDetailsCreateUpdateStateProvinceRegionBuffer = null;

var frmApplicationUserDetailsCreateUpdatePostCodeBuffer = null;

var frmApplicationUserDetailsCreateUpdateCountryTextBuffer = null;
var frmApplicationUserDetailsCreateUpdateCountryValueBuffer = 0;
var frmApplicationUserDetailsCreateUpdateCountrySetupCompleted = false;

var frmApplicationUserDetailsCreateUpdateAmenitiesTextBuffer = null;
var frmApplicationUserDetailsCreateUpdateAmenitiesValueBuffer = 0;
var frmApplicationUserDetailsCreateUpdateAmenitiesSetupCompleted = false;

var frmApplicationUserDetailsCreateUpdateFacilitiesTextBuffer = null;
var frmApplicationUserDetailsCreateUpdateFacilitiesValueBuffer = 0;
var frmApplicationUserDetailsCreateUpdateFacilitiesSetupCompleted = false;

var frmApplicationUserDetailsCreateUpdateAccommodateWhoTextBuffer = null;
var frmApplicationUserDetailsCreateUpdateAccommodateWhoValueBuffer = 0;
var frmApplicationUserDetailsCreateUpdateAccommodateWhoSetupCompleted = false;


var frmApplicationUserDetailsCreateUpdateEmailAddressBuffer = null;

var frmAccommodationPledgeCreateUpdateAddressOneBuffer = null;

var frmAccommodationPledgeCreateUpdateAddressTwoBuffer = null;

var frmAccommodationPledgeCreateUpdateCityBuffer = null;

var frmAccommodationPledgeCreateUpdateStateProvinceRegionBuffer = null;

var frmAccommodationPledgeCreateUpdatePostCodeBuffer = null;

var frmAccommodationPledgeCreateUpdateCountryTextBuffer = null;
var frmAccommodationPledgeCreateUpdateCountryValueBuffer = 0;
var frmAccommodationPledgeCreateUpdateCountrySetupCompleted = false;

var frmAccommodationPledgeCreateUpdateOwnerOccupierTextBuffer = null;
var frmAccommodationPledgeCreateUpdateOwnerOccupierValueBuffer = 0;
var frmAccommodationPledgeCreateUpdateOwnerOccupierSetupCompleted = false;

var frmAccommodationPledgeCreateUpdateAccommodationDateFromBuffer = null;

var frmAccommodationPledgeCreateUpdateAccommodationDateToBuffer = null;

var frmAccommodationPledgeCreateUpdateAccommodationTypeTextBuffer = null;
var frmAccommodationPledgeCreateUpdateAccommodationTypeValueBuffer = 0;
var frmAccommodationPledgeCreateUpdateAccommodationTypeSetupCompleted = false;

var frmAccommodationPledgeCreateUpdateAccommodationConditionTextBuffer = null;
var frmAccommodationPledgeCreateUpdateAccommodationConditionValueBuffer = 0;
var frmAccommodationPledgeCreateUpdateAccommodationConditionSetupCompleted = false;

var frmAccommodationPledgeCreateUpdateNumberOfBedsTextBuffer = null;
var frmAccommodationPledgeCreateUpdateNumberOfBedsValueBuffer = 0;
var frmAccommodationPledgeCreateUpdateNumberOfBedsSetupCompleted = false;

var frmAccommodationPledgeCreateUpdateVacantOrSharedTextBuffer = null;
var frmAccommodationPledgeCreateUpdateVacantOrSharedValueBuffer = 0;
var frmAccommodationPledgeCreateUpdateVacantOrSharedSetupCompleted = false;

var frmAccommodationPledgeCreateUpdateOtherAmenitiesBuffer = null;

var frmAccommodationPledgeCreateUpdateCanYouAccommodateTextBuffer = null;
var frmAccommodationPledgeCreateUpdateCanYouAccommodateValueBuffer = 0;
var frmAccommodationPledgeCreateUpdateCanYouAccommodateSetupCompleted = false;

var frmAccommodationPledgeCreateUpdateAdditionalInformationBuffer = null;

var frmServicePledgeCreateUpdatePledgeServiceLevelOneTextBuffer = null;
var frmServicePledgeCreateUpdatePledgeServiceLevelOneValueBuffer = 0;
var frmServicePledgeCreateUpdatePledgeServiceLevelOneSetupCompleted = false;

var frmServicePledgeCreateUpdatePledgeServiceLevelTwoTextBuffer = null;
var frmServicePledgeCreateUpdatePledgeServiceLevelTwoValueBuffer = 0;
var frmServicePledgeCreateUpdatePledgeServiceLevelTwoSetupCompleted = false;

var frmServicePledgeCreateUpdatePledgeServiceLevelThreeTextBuffer = null;
var frmServicePledgeCreateUpdatePledgeServiceLevelThreeValueBuffer = 0;
var frmServicePledgeCreateUpdatePledgeServiceLevelThreeSetupCompleted = false;

var frmServicePledgeCreateUpdateAdditionalInformationBuffer = null;

var frmServicePledgeCreateUpdatePledgeServiceQualificationBuffer = null;

var frmServicePledgeCreateUpdatePledgeServiceDateAvailableBuffer = null;
var frmServicePledgeCreateUpdatePledgeServiceDateAvailableToBuffer = null;

var frmServicePledgeCreateUpdatePledgeServiceHoursPerWeekTextBuffer = null;
var frmServicePledgeCreateUpdatePledgeServiceHoursPerWeekValueBuffer = 0;
var frmServicePledgeCreateUpdatePledgeServiceHoursPerWeekSetupCompleted = false;

var frmGoodsPledgeCreateUpdateGoodsCategoryOneTextBuffer = null;
var frmGoodsPledgeCreateUpdateGoodsCategoryOneValueBuffer = 0;
var frmGoodsPledgeCreateUpdateGoodsCategoryOneSetupCompleted = false;

var frmGoodsPledgeCreateUpdateGoodsCategoryTwoTextBuffer = null;
var frmGoodsPledgeCreateUpdateGoodsCategoryTwoValueBuffer = 0;
var frmGoodsPledgeCreateUpdateGoodsCategoryTwoSetupCompleted = false;

var frmGoodsPledgeCreateUpdateGoodsCategoryThreeTextBuffer = null;
var frmGoodsPledgeCreateUpdateGoodsCategoryThreeValueBuffer = 0;
var frmGoodsPledgeCreateUpdateGoodsCategoryThreeSetupCompleted = false;

var frmGoodsPledgeCreateUpdateGoodsSizeTextBuffer = null;
var frmGoodsPledgeCreateUpdateGoodsSizeValueBuffer = 0;
var frmGoodsPledgeCreateUpdateGoodsSizeSetupCompleted = false;

var frmGoodsPledgeCreateUpdateGoodsNewOrUsedTextBuffer = null;
var frmGoodsPledgeCreateUpdateGoodsNewOrUsedValueBuffer = 0;
var frmGoodsPledgeCreateUpdateGoodsNewOrUsedSetupCompleted = false;

var frmGoodsPledgeCreateUpdateGoodsConditionTextBuffer = null;
var frmGoodsPledgeCreateUpdateGoodsConditionValueBuffer = 0;
var frmGoodsPledgeCreateUpdateGoodsConditionSetupCompleted = false;

var frmGoodsPledgeCreateUpdateGoodsQuantityTextBuffer = null;
var frmGoodsPledgeCreateUpdateGoodsQuantityValueBuffer = 0;
var frmGoodsPledgeCreateUpdateGoodsQuantitySetupCompleted = false;

var frmGoodsPledgeCreateUpdateAdditionalInformationBuffer = null;

var frmGoodsPledgeCreateUpdateItemSizeBuffer = null;


$( document ).ready(function() {
	var displayTextAreaCount = false;
	var validateOnKeyEvents = false;

	$.ajaxSetup({cache: false});
	var token = $("meta[name='_csrf']").attr("content");
	var header = $("meta[name='_csrf_header']").attr("content");
	$(document).ajaxSend(function(e, xhr, options) {
		xhr.setRequestHeader(header, token);
	});

	try{
		var feedbackMessage = document.getElementById('frmRegisterOfPledgesLoadedFeedbackMessage').value
		var feedbackCss = document.getElementById('frmRegisterOfPledgesLoadedFeedbackCss').value

		if (feedbackMessage != "" && feedbackCss != ""){
			writeAlert(feedbackMessage, feedbackCss, 5000);
		}
	}
	catch (ex){
		// Do nothing
	}

	var mainFormObjectId = document.getElementById("frmRegisterOfPledgesRegisterOfPledgesId").value;
	// focus on the first input capable of receiving focus.
	checkFocus(document.getElementById("frmRegisterOfPledges"));



	$.fn.datepicker.defaults.format = "dd/mm/yyyy";
	$.fn.datepicker.defaults.autoclose = true;
	$('.datepicker').datepicker();

	$('.datepicker').on('show.bs.modal', function (event) {
		event.stopPropagation();
	});




	if (displayTextAreaCount){

		registerTextareaCount();
	}

	if (validateOnKeyEvents){
		registerKeyEventListeners();
	}


	var accommodationPledgesTableBody = document.getElementById("accommodationPledgesTableBody");

	if (mainFormObjectId.length > 0){
		$.ajax({
			dataType: "json",
			url: rootContext + "/restful/registerofpledges/accommodationpledges/list",
			data: {
				id: mainFormObjectId
			},
			success: function( data ) {
				$.each(data, function(idx, obj) {
					var row = document.createElement("tr");
					var cell = document.createElement("td");
					var editModalAnchorText = "<a href='#' class='btn btn-info btn-sm' data-toggle='modal' data-backdrop='static' data-target='#accommodationPledgeCreateUpdateModal' data-id='" + obj.id + "' data-modal-title='OFFER ACCOMMODATION' data-callback-table-body-id='accommodationPledgesTableBody' data-property-url='accommodationpledges' data-callback-display-type='table' aria-label='view'><span class='glyphicon glyphicon-edit'></a>";
					var editAnchorURI = rootContext + "/accommodationpledge/" + obj.id + "/update";
					var editAnchorText = "<a href='" + editAnchorURI + "' class='btn btn-primary btn-sm' aria-label='view'><span class='glyphicon glyphicon-pencil'></a>";
					cell.innerHTML = "<div class='btn-group-vertical' role='group'>" + editModalAnchorText  + "</div>";
					row.appendChild(cell);

					var cell = document.createElement("td");
					var cellText = document.createTextNode(obj.accommodationTypeReferenceTranslation);
					cell.appendChild(cellText);
					row.appendChild(cell);

					var cell = document.createElement("td");
					var cellText = document.createTextNode(obj.accommodationConditionReferenceTranslation);
					cell.appendChild(cellText);
					row.appendChild(cell);

					var cell = document.createElement("td");
					var cellText = document.createTextNode(obj.numberOfBedsReferenceTranslation);
					cell.appendChild(cellText);
					row.appendChild(cell);

					var cell = document.createElement("td");
					var cellText = document.createTextNode(obj.vacantOrSharedReferenceTranslation);
					cell.appendChild(cellText);
					row.appendChild(cell);

					var cell = document.createElement("td");
					var cellText = document.createTextNode(obj.canYouAccommodateReferenceTranslation);
					cell.appendChild(cellText);
					row.appendChild(cell);

					var cell = document.createElement("td");
					var cellText = document.createTextNode(obj.accommodationDateFrom);
					cell.appendChild(cellText);
					row.appendChild(cell);

					var cell = document.createElement("td");
					var cellText = document.createTextNode(obj.accommodationDateTo);
					cell.appendChild(cellText);
					row.appendChild(cell);
					accommodationPledgesTableBody.appendChild(row);
				});
			}
		});

	}


	var servicePledgesTableBody = document.getElementById("servicePledgesTableBody");

	if (mainFormObjectId.length > 0){
		$.ajax({
			dataType: "json",
			url: rootContext + "/restful/registerofpledges/servicepledges/list",
			data: {
				id: mainFormObjectId
			},
			success: function( data ) {
				$.each(data, function(idx, obj) {
					var row = document.createElement("tr");
					var cell = document.createElement("td");
					var editModalAnchorText = "<a href='#' class='btn btn-info btn-sm' data-toggle='modal' data-backdrop='static' data-target='#servicePledgeCreateUpdateModal' data-id='" + obj.id + "' data-modal-title='OFFER SKILLS/SERVICES' data-callback-table-body-id='servicePledgesTableBody' data-property-url='servicepledges' data-callback-display-type='table' aria-label='view'><span class='glyphicon glyphicon-edit'></a>";
					var editAnchorURI = rootContext + "/servicepledge/" + obj.id + "/update";
					var editAnchorText = "<a href='" + editAnchorURI + "' class='btn btn-primary btn-sm' aria-label='view'><span class='glyphicon glyphicon-pencil'></a>";
					cell.innerHTML = "<div class='btn-group-vertical' role='group'>" + editModalAnchorText  + "</div>";
					row.appendChild(cell);

					var cell = document.createElement("td");
					var cellText = document.createTextNode(obj.pledgeServiceDateAvailable);
					cell.appendChild(cellText);
					row.appendChild(cell);


					var cell = document.createElement("td");
					var cellText = document.createTextNode(obj.pledgeServiceDateAvailableTo);
					cell.appendChild(cellText);
					row.appendChild(cell);

					var cell = document.createElement("td");
					var cellText = document.createTextNode(obj.pledgeServiceLevelOneReferenceTranslation);
					cell.appendChild(cellText);
					row.appendChild(cell);

					var cell = document.createElement("td");
					var cellText = document.createTextNode(obj.pledgeServiceLevelTwoReferenceTranslation);
					cell.appendChild(cellText);
					row.appendChild(cell);

					var cell = document.createElement("td");
					var cellText = document.createTextNode(obj.pledgeServiceLevelThreeReferenceTranslation);
					cell.appendChild(cellText);
					row.appendChild(cell);

					var cell = document.createElement("td");
					var cellText = document.createTextNode(obj.pledgeServiceQualification);
					cell.appendChild(cellText);
					row.appendChild(cell);

					var cell = document.createElement("td");
					var cellText = document.createTextNode(obj.additionalInformation);
					cell.appendChild(cellText);
					row.appendChild(cell);
					servicePledgesTableBody.appendChild(row);
				});
			}
		});
	}


	var goodsPledgesTableBody = document.getElementById("goodsPledgesTableBody");

	if (mainFormObjectId.length > 0){
		$.ajax({
			dataType: "json",
			url: rootContext + "/restful/registerofpledges/goodspledges/list",
			data: {
				id: mainFormObjectId
			},
			success: function( data ) {
				$.each(data, function(idx, obj) {
					var row = document.createElement("tr");
					var cell = document.createElement("td");
					var editModalAnchorText = "<a href='#' class='btn btn-info btn-sm' data-toggle='modal' data-backdrop='static' data-target='#goodsPledgeCreateUpdateModal' data-id='" + obj.id + "' data-modal-title='OFFER GOODS AND MEDICINES' data-callback-table-body-id='goodsPledgesTableBody' data-property-url='goodspledges' data-callback-display-type='table' aria-label='view'><span class='glyphicon glyphicon-edit'></a>";
					var editAnchorURI = rootContext + "/goodspledge/" + obj.id + "/update";
					var editAnchorText = "<a href='" + editAnchorURI + "' class='btn btn-primary btn-sm' aria-label='view'><span class='glyphicon glyphicon-pencil'></a>";
					cell.innerHTML = "<div class='btn-group-vertical' role='group'>" + editModalAnchorText  + "</div>";
					row.appendChild(cell);

					var cell = document.createElement("td");
					var cellText = document.createTextNode(obj.goodsCategoryOneReferenceTranslation);
					cell.appendChild(cellText);
					row.appendChild(cell);

					var cell = document.createElement("td");
					var cellText = document.createTextNode(obj.goodsCategoryTwoReferenceTranslation);
					cell.appendChild(cellText);
					row.appendChild(cell);

					var cell = document.createElement("td");
					var cellText = document.createTextNode(obj.goodsCategoryThreeReferenceTranslation);
					cell.appendChild(cellText);
					row.appendChild(cell);
					goodsPledgesTableBody.appendChild(row);
				});
			}
		});
	}


	var frmApplicationUserDetailsCreateUpdateLaddaSubmitButtonHandler = null;


	$('#applicationUserDetailsCreateUpdateModal').modal('handleUpdate');

	$('#applicationUserDetailsCreateUpdateModal').on('show.bs.modal', function (event) {
		var button = $(event.relatedTarget); // Button that triggered the modal
		var id = button.data('id'); // Extract info from data-* attributes
		var modalTitle = button.data('modal-title');
		var callBackDisplayType = button.data('callback-display-type');
		var callBackTableId = button.data('callback-table-body-id');
		var propertyUrl = button.data('property-url');

		var modal = $(this);
		modal.find('.modal-title').text(modalTitle);
		modal.find('#frmApplicationUserDetailsCreateUpdateLoadedObjectId').val(id);
		modal.find('#frmApplicationUserDetailsCreateUpdateParentObjectId').val(mainFormObjectId);
		modal.find('#frmApplicationUserDetailsCreateUpdateCallBackDisplayType').val(callBackDisplayType);
		modal.find('#frmApplicationUserDetailsCreateUpdateCallBackTableBodyId').val(callBackTableId);
		modal.find('#frmApplicationUserDetailsCreateUpdatePropertyUrl').val(propertyUrl);


		if (mainFormObjectId == ''){
			var invalidParentIdMessage = button.data('invalid-parent-id-message'); // Extract info from data-* attributes
			$('#applicationUserDetailsCreateUpdateModal').find('.modal-body').html('<p>' + invalidParentIdMessage + '</p>');
			$("#frmApplicationUserDetailsCreateUpdateSubmitButton").hide();
			return;
		}

		if (frmApplicationUserDetailsCreateUpdateLaddaSubmitButtonHandler == null){
			frmApplicationUserDetailsCreateUpdateLaddaSubmitButtonHandler = Ladda.create(document.querySelector("#frmApplicationUserDetailsCreateUpdateSubmitButton"));
		}

		frmApplicationUserDetailsCreateUpdateLaddaSubmitButtonHandler.start();


		var representOrganisationSelectInput = document.getElementById('frmApplicationUserDetailsCreateUpdateRepresentOrganisation');

		if (representOrganisationSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "Yes_No"
				},
				success: function( data ) {
					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
					
					unselectedOption.textContent = "Select are you pledging on behalf of an organisation?";
					representOrganisationSelectInput.appendChild(unselectedOption);

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						//hardcoding this for the moment... needs to be sorted if other languages are used
						if(el.textContent=="Yes"){
							el.value = true;
						}else{
							el.value = false;
						}

						representOrganisationSelectInput.appendChild(el);
						frmApplicationUserDetailsCreateUpdateRepresentOrganisationSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmApplicationUserDetailsCreateUpdateRepresentOrganisationSetupCompleted = true;
		}
		$(representOrganisationSelectInput).change(function(v){
			$('#frmApplicationUserDetailsCreateUpdateOrganisationNameFormGroup').toggle($(this).val());
		});
		var countrySelectInput = document.getElementById('frmApplicationUserDetailsCreateUpdateCountry');

		if (countrySelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "EuropeCountry"
				},
				success: function( data ) {
					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
					unselectedOption.textContent = "Select Country";
					countrySelectInput.appendChild(unselectedOption);

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						countrySelectInput.appendChild(el);
						frmApplicationUserDetailsCreateUpdateCountrySetupCompleted = true;
					});
				}
			});
		}
		else{
			frmApplicationUserDetailsCreateUpdateCountrySetupCompleted = true;
		}

		var facilitiesSelectInput = document.getElementById('frmApplicationUserDetailsCreateUpdateFacilitiesSelect');
		if (facilitiesSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "Facilities"
				},
				success: function( data ) {
					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
//					unselectedOption.textContent = "Select Available Facilities";
					facilitiesSelectInput.appendChild(unselectedOption);

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;
						facilitiesSelectInput.appendChild(el);
						frmApplicationUserDetailsCreateUpdateFacilitiesSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmApplicationUserDetailsCreateUpdateFacilitiesSetupCompleted = true;
		}

		var amenitiesSelectInput = document.getElementById('frmApplicationUserDetailsCreateUpdateAmenitiesSelect');
		if (amenitiesSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "LocalAmenity"
				},
				success: function( data ) {
					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
//					unselectedOption.textContent = "Select Amenities";
//					amenitiesSelectInput.appendChild(unselectedOption);

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;
						
						amenitiesSelectInput.appendChild(el);
						frmApplicationUserDetailsCreateUpdateAmenitiesSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmApplicationUserDetailsCreateUpdateAmenitiesSetupCompleted = true;
		}

		
		var accommodateWhoSelectInput = document.getElementById('frmApplicationUserDetailsCreateUpdateAccommodateWhoSelect');
		if (accommodateWhoSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "YouCanAccommodate"
				},
				success: function( data ) {
					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
				
					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;
						accommodateWhoSelectInput.appendChild(el);
						frmApplicationUserDetailsCreateUpdateAccommodateWhoSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmApplicationUserDetailsCreateUpdateAccommodateWhoSetupCompleted = true;
		}



		// Reset all of the input contents.
		$( modal.find("input[type=text], input[type=tel], input[type=email], input[type=checkbox], textarea, select")).each(function(){
			var containerId = ('#').concat($(this).attr('id')).concat('FormGroup');
			var feedbackIconContainerId = ('#').concat($(this).attr('id')).concat('FeedbackIcon');
			var feedbackHelpBlockId = ('#').concat($(this).attr('id')).concat('HelpBlock');

			if ($(this).is('select')){
				var selectType = $(this).data('select-type');
				if (selectType == 'child'){
					removeSelectOptions(document.getElementById($(this).attr('id')));
				}
				else{
					$(this).val(-1);
				} 
			}
			else if ($(this).is(':checkbox')){
				$(this).prop('checked', false); 
			}
			else{
				$(this).val("");
			}
			//$(feedbackHelpBlockId).text('');
			$(containerId).toggleClass('has-warning', false);
			$(feedbackIconContainerId).toggleClass('glyphicon-warning-sign', false);
			$(containerId).toggleClass('has-success', false);
			$(feedbackIconContainerId).toggleClass('glyphicon-ok', false);
			$(containerId).toggleClass('has-error', false);
			$(feedbackIconContainerId).toggleClass('glyphicon-remove', false);
		});

		if (id != null){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/applicationuserdetails",
				data: {
					id: id
				},
				success: function( data ) {

					//modal.find('#frmApplicationUserDetailsCreateUpdateContactInformationInstructions').focus();

					modal.find('#frmApplicationUserDetailsCreateUpdateContactName').val(data.contactName);
					frmApplicationUserDetailsCreateUpdateContactNameBuffer = data.contactName;

					function frmApplicationUserDetailsCreateUpdateRepresentOrganisationTimeOut() {
						setTimeout(function () {
							if (frmApplicationUserDetailsCreateUpdateRepresentOrganisationSetupCompleted == false){
								frmApplicationUserDetailsCreateUpdateRepresentOrganisationTimeOut();
							}
							else{
								if (data.representOrganisation != null){
									representOrganisationSelectInput.value = data.representOrganisation;
								}
								else{
									representOrganisationSelectInput.value = -1;
									frmApplicationUserDetailsCreateUpdateRepresentOrganisationValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmApplicationUserDetailsCreateUpdateRepresentOrganisationTimeOut();

					modal.find('#frmApplicationUserDetailsRepresentOrganisation').val(data.representOrganisation);
					
					modal.find('#frmApplicationUserDetailsCreateUpdateTelephoneNumber').val(data.telephoneNumber);
					frmApplicationUserDetailsCreateUpdateTelephoneNumberBuffer = data.telephoneNumber;

					modal.find('#frmApplicationUserDetailsCreateUpdateAddressOne').val(data.addressOne);
					frmApplicationUserDetailsCreateUpdateAddressOneBuffer = data.addressOne;

					modal.find('#frmApplicationUserDetailsCreateUpdateAddressTwo').val(data.addressTwo);
					frmApplicationUserDetailsCreateUpdateAddressTwoBuffer = data.addressTwo;

					modal.find('#frmApplicationUserDetailsCreateUpdateCity').val(data.city);
					frmApplicationUserDetailsCreateUpdateCityBuffer = data.city;

					modal.find('#frmApplicationUserDetailsCreateUpdateStateProvinceRegion').val(data.stateProvinceRegion);
					frmApplicationUserDetailsCreateUpdateStateProvinceRegionBuffer = data.stateProvinceRegion;

					modal.find('#frmApplicationUserDetailsCreateUpdatePostCode').val(data.postCode);
					frmApplicationUserDetailsCreateUpdatePostCodeBuffer = data.postCode;

					modal.find('#frmApplicationUserDetailsRepresentOrganisation').val(data.representOrganisationReferenceTranslation);
					modal.find('#frmApplicationUserDetailsCreateUpdateOrganisationNameFormGroup').toggle(data.representOrganisation);
//					frmApplicationUserDetailsCreateUpdateRepresentOrganisationBuffer = data.representOrganisation;
					
					modal.find('#frmApplicationUserDetailsCreateUpdateOrganisationName').val(data.organisationName);
					frmApplicationUserDetailsCreateUpdateOrganisationNameBuffer = data.organisationName;
					

					function frmApplicationUserDetailsCreateUpdateCountryTimeOut() {
						setTimeout(function () {
							if (frmApplicationUserDetailsCreateUpdateCountrySetupCompleted == false){
								frmApplicationUserDetailsCreateUpdateCountryTimeOut();
							}
							else{
								if (data.country != null){
									countrySelectInput.value = data.country;
								}
								else{
									countrySelectInput.value = -1;
									frmApplicationUserDetailsCreateUpdateCountryValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmApplicationUserDetailsCreateUpdateCountryTimeOut();

					modal.find('#frmApplicationUserDetailsCreateUpdateEmailAddress').val(data.emailAddress);
					frmApplicationUserDetailsCreateUpdateEmailAddressBuffer = data.emailAddress;

				}
			});
		}


	});	

	$('#applicationUserDetailsCreateUpdateModal').on('shown.bs.modal', function (event) {
		if (frmApplicationUserDetailsCreateUpdateLaddaSubmitButtonHandler != null){
			frmApplicationUserDetailsCreateUpdateLaddaSubmitButtonHandler.stop();
		}
		$('#frmApplicationUserDetailsCreateUpdateContactInformationInstructions').focus();
		
	});	






	$("#frmApplicationUserDetailsCreateUpdateSubmitButton").click(function( event ) {
		frmApplicationUserDetailsCreateUpdateLaddaSubmitButtonHandler.start();
		var validationSuccess = true;
		var mode = null;
		var modal = $('#applicationUserDetailsCreateUpdateModal');
		var modalTitle = modal.find('#frmApplicationUserDetailsCreateUpdateTitle').val();
		var callBackDisplayType = modal.find('#frmApplicationUserDetailsCreateUpdateCallBackDisplayType').val();

		$( modal.find("input[type=text], input[type=tel], input[type=email], input[type=checkbox][aria-describedby], textarea, select")).each(function(){
			var containerId = ('#').concat($(this).attr('id')).concat('FormGroup');
			var feedbackIconContainerId = ('#').concat($(this).attr('id')).concat('FeedbackIcon');
			var feedbackAlertBlockId = ('#').concat($(this).attr('id')).concat('AlertBlock');
			var feedbackAlertBlockTextId = ('#').concat($(this).attr('id')).concat('AlertBlockText');
			var feedbackHelpBlockId = ('#').concat($(this).attr('id')).concat('HelpBlock');

			if ($(this).data('required') == true){
				if ( ( !$(this).is(':checkbox') && ($(this).val() == -1 || $(this).val() == '') ) || ( $(this).is(':checkbox') && !$(this).is(':checked') ) ){
					if ($(this).is(':checkbox')){
						$(feedbackHelpBlockId).text('Please check the ' + $(this).data('display-name') + ' checkbox');
						//showalert(feedbackAlertBlockId, feedbackAlertBlockTextId, 'Please check the ' + $(this).data('display-name') + ' checkbox', 'alert-danger')    					
					}else{
						$(feedbackHelpBlockId).text('Please enter a value for ' + $(this).data('display-name'));
						//showalert(feedbackAlertBlockId, feedbackAlertBlockTextId, 'Please enter a value for ' + $(this).data('display-name'), 'alert-danger')
					}
					$(containerId).toggleClass('has-error', true);
					if (!$(this).is(':checkbox')){
						$(feedbackIconContainerId).toggleClass('glyphicon-remove', true);
					}
					validationSuccess = false;
				}
			}

		});

		if (validationSuccess == false){
			frmApplicationUserDetailsCreateUpdateLaddaSubmitButtonHandler.stop();
			return false;
		}


		if (modal.find('#frmApplicationUserDetailsCreateUpdateLoadedObjectId').val().length > 0){
			mode = "update";
		}
		else{
			mode="new";
		}




		var applicationUserDetails = {
				parentObjectId : modal.find('#frmApplicationUserDetailsCreateUpdateParentObjectId').val(),
				id : modal.find('#frmApplicationUserDetailsCreateUpdateLoadedObjectId').val(),
				contactName : modal.find('#frmApplicationUserDetailsCreateUpdateContactName').val(),
				representOrganisation : modal.find('#frmApplicationUserDetailsCreateUpdateRepresentOrganisation').val(),
				organisationName : modal.find('#frmApplicationUserDetailsCreateUpdateOrganisationName').val(),
				telephoneNumber : modal.find('#frmApplicationUserDetailsCreateUpdateTelephoneNumber').val(),
				addressOne : modal.find('#frmApplicationUserDetailsCreateUpdateAddressOne').val(),
				addressTwo : modal.find('#frmApplicationUserDetailsCreateUpdateAddressTwo').val(),
				city : modal.find('#frmApplicationUserDetailsCreateUpdateCity').val(),
				stateProvinceRegion : modal.find('#frmApplicationUserDetailsCreateUpdateStateProvinceRegion').val(),
				postCode : modal.find('#frmApplicationUserDetailsCreateUpdatePostCode').val(),
				country : modal.find('#frmApplicationUserDetailsCreateUpdateCountry').val(),
				emailAddress : modal.find('#frmApplicationUserDetailsCreateUpdateEmailAddress').val()
		};

		var propertyUrl = modal.find('#frmApplicationUserDetailsCreateUpdatePropertyUrl').val();
		var url = rootContext + "/restful/registerofpledges/" + propertyUrl + "/" + mode;

		$.ajax({
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			method: "post",
			url: url,
			data: JSON.stringify(applicationUserDetails),
			success: function( data ) {
				if ( ($('#frmRegisterOfPledgesMode').val() == 'ADD') || ($('#frmRegisterOfPledgesMode').val() == 'UPDATE')){
					if (callBackDisplayType == "table"){
						var new_tbody = document.createElement('tbody');
						var callBackTableBodyId = modal.find('#frmApplicationUserDetailsCreateUpdateCallBackTableBodyId').val();
						var callBackTableBody = document.getElementById(callBackTableBodyId);

						$.each(data, function(idx, obj) {
							var row = document.createElement("tr");
							var cell = document.createElement("td");
							var editModalAnchorText = "<a href='#' class='btn btn-info btn-sm' data-toggle='modal' data-backdrop='static' data-target='#applicationUserDetailsCreateUpdateModal' data-id='" + obj.id + "' data-modal-title='" + modalTitle + "' data-callback-table-body-id='" + callBackTableBodyId + "' data-property-url='applicationuserdetails' data-callback-display-type='inline' aria-label='view'><span class='glyphicon glyphicon-edit'></a>";
							var editAnchorURI = rootContext + "/applicationuserdetails/" + obj.id + "/update";
							var editAnchorText = "<a href='" + editAnchorURI + "' class='btn btn-primary btn-sm' aria-label='view'><span class='glyphicon glyphicon-pencil'></a>";
							cell.innerHTML = "<div class='btn-group-vertical' role='group'>" + editModalAnchorText  + "</div>";
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.contactName);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
//							var cellText = document.createTextNode(obj.representOrganisation) == "true"?"Yes":"No";
							var cellText = document.createTextNode(obj.representOrganisationReferenceTranslation);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.emailAddress);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.telephoneNumber);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.addressOne);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.addressTwo);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.city);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.stateProvinceRegion);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.postCode);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.countryReferenceTranslation);
							cell.appendChild(cellText);
							row.appendChild(cell);

							new_tbody.appendChild(row);
						});

						callBackTableBody.parentNode.replaceChild(new_tbody, callBackTableBody);
						new_tbody.id = callBackTableBodyId;
					}
					else if (callBackDisplayType == "inline"){
						$.each(data, function(idx, obj) {

							document.getElementById("frmApplicationUserDetailsContactNameMessage").innerHTML = obj.contactName;

							document.getElementById("frmApplicationUserDetailsRepresentOrganisationMessage").innerHTML = obj.representOrganisationReferenceTranslation;

//							document.getElementById("frmApplicationUserDetailsEmailAddressMessage").innerHTML = obj.emailAddress;

							document.getElementById("frmApplicationUserDetailsTelephoneNumberMessage").innerHTML = obj.telephoneNumber;

							document.getElementById("frmApplicationUserDetailsAddressOneMessage").innerHTML = obj.addressOne;

							document.getElementById("frmApplicationUserDetailsAddressTwoMessage").innerHTML = obj.addressTwo;

							document.getElementById("frmApplicationUserDetailsCityMessage").innerHTML = obj.city;

							document.getElementById("frmApplicationUserDetailsStateProvinceRegionMessage").innerHTML = obj.stateProvinceRegion;

							document.getElementById("frmApplicationUserDetailsPostCodeMessage").innerHTML = obj.postCode;

							document.getElementById("frmApplicationUserDetailsCountryMessage").innerHTML = obj.countryReferenceTranslation;

						});
					}
				}

				modal.modal('hide');
			},
			error: function(jqXHR, textStatus, errorThrown) {
				if(jqXHR.status==403) {
					alert('403 returned');
				}

				console.log(textStatus, errorThrown);
			}
		});
	});


	$("#frmApplicationUserDetailsCreateUpdateCloseButton").click(function( event ) {
		var mode = null;
		var modal = $('#applicationUserDetailsCreateUpdateModal');
		var callBackTableBodyId = modal.find('#frmApplicationUserDetailsCreateUpdateCallBackTableBodyId').val();
		var callBackTableBody = document.getElementById(callBackTableBodyId);
		var modalTitle = modal.find('#frmApplicationUserDetailsCreateUpdateTitle').val();


		modal.modal('hide');
	});





	var frmAccommodationPledgeCreateUpdateLaddaSubmitButtonHandler = null;


	$('#accommodationPledgeCreateUpdateModal').modal('handleUpdate');

	$('#accommodationPledgeCreateUpdateModal').on('show.bs.modal', function (event) {
		var button = $(event.relatedTarget); // Button that triggered the modal
		var id = button.data('id'); // Extract info from data-* attributes
		var modalTitle = button.data('modal-title');
		var callBackDisplayType = button.data('callback-display-type');
		var callBackTableId = button.data('callback-table-body-id');
		var propertyUrl = button.data('property-url');

		var modal = $(this);
		modal.find('.modal-title').text(modalTitle);
		modal.find('#frmAccommodationPledgeCreateUpdateLoadedObjectId').val(id);
		modal.find('#frmAccommodationPledgeCreateUpdateParentObjectId').val(mainFormObjectId);
		modal.find('#frmAccommodationPledgeCreateUpdateCallBackDisplayType').val(callBackDisplayType);
		modal.find('#frmAccommodationPledgeCreateUpdateCallBackTableBodyId').val(callBackTableId);
		modal.find('#frmAccommodationPledgeCreateUpdatePropertyUrl').val(propertyUrl);


		if (mainFormObjectId == ''){
			var invalidParentIdMessage = button.data('invalid-parent-id-message'); // Extract info from data-* attributes
			$('#accommodationPledgeCreateUpdateModal').find('.modal-body').html('<p>' + invalidParentIdMessage + '</p>');
			$("#frmAccommodationPledgeCreateUpdateSubmitButton").hide();
			return;
		}

		if (frmAccommodationPledgeCreateUpdateLaddaSubmitButtonHandler == null){
			frmAccommodationPledgeCreateUpdateLaddaSubmitButtonHandler = Ladda.create(document.querySelector("#frmAccommodationPledgeCreateUpdateSubmitButton"));
		}

		frmAccommodationPledgeCreateUpdateLaddaSubmitButtonHandler.start();


		var countrySelectInput = document.getElementById('frmAccommodationPledgeCreateUpdateCountry');

		if (countrySelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "EuropeCountry"
				},
				success: function( data ) {
					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
					unselectedOption.textContent = "Select Country";
					countrySelectInput.appendChild(unselectedOption);

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						countrySelectInput.appendChild(el);
						frmAccommodationPledgeCreateUpdateCountrySetupCompleted = true;
					});
				}
			});
		}
		else{
			frmAccommodationPledgeCreateUpdateCountrySetupCompleted = true;
		}

		
		var facilitiesSelectInput = document.getElementById('frmApplicationUserDetailsCreateUpdateFacilitiesSelect');
		if (facilitiesSelectInput.length == 0 ){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "LocalAmenity"
				},
				success: function( data ) {

					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						facilitiesSelectInput.appendChild(el);
						frmApplicationUserDetailsCreateUpdateFacilitiesSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmApplicationUserDetailsCreateUpdateFacilitiesSetupCompleted = true;
		}

		var amenitiesSelectInput = document.getElementById('frmApplicationUserDetailsCreateUpdateAmenitiesSelect');
		if (amenitiesSelectInput.length == 0 ){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "LocalAmenity"
				},
				success: function( data ) {

					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						amenitiesSelectInput.appendChild(el);
						frmApplicationUserDetailsCreateUpdateAmenitiesSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmApplicationUserDetailsCreateUpdateAmenitiesSetupCompleted = true;
		}
		
		var accommodateWhoSelectInput = document.getElementById('frmApplicationUserDetailsCreateUpdateAccommodateWhoSelect');
		if (accommodateWhoSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "YouCanAccommodate"
				},
				success: function( data ) {
					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
				
					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;
						accommodateWhoSelectInput.appendChild(el);
						frmApplicationUserDetailsCreateUpdateAccommodateWhoSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmApplicationUserDetailsCreateUpdateAccommodateWhoSetupCompleted = true;
		}
		
		var ownerOccupierSelectInput = document.getElementById('frmAccommodationPledgeCreateUpdateOwnerOccupier');

		if (ownerOccupierSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "OwnerOccupierType"
				},
				success: function( data ) {
					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
					unselectedOption.textContent = "Select Who owns the accommodation?";
					ownerOccupierSelectInput.appendChild(unselectedOption);

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						ownerOccupierSelectInput.appendChild(el);
						frmAccommodationPledgeCreateUpdateOwnerOccupierSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmAccommodationPledgeCreateUpdateOwnerOccupierSetupCompleted = true;
		}

		var accommodationTypeSelectInput = document.getElementById('frmAccommodationPledgeCreateUpdateAccommodationType');

		if (accommodationTypeSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "AccommodationType"
				},
				success: function( data ) {
					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
					unselectedOption.textContent = "Select What kind of accommodation are you pledging?";
					accommodationTypeSelectInput.appendChild(unselectedOption);

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						accommodationTypeSelectInput.appendChild(el);
						frmAccommodationPledgeCreateUpdateAccommodationTypeSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmAccommodationPledgeCreateUpdateAccommodationTypeSetupCompleted = true;
		}

		var accommodationConditionSelectInput = document.getElementById('frmAccommodationPledgeCreateUpdateAccommodationCondition');

		if (accommodationConditionSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "AccommodationCondition"
				},
				success: function( data ) {
					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
					unselectedOption.textContent = "Select Condition";
					accommodationConditionSelectInput.appendChild(unselectedOption);

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						accommodationConditionSelectInput.appendChild(el);
						frmAccommodationPledgeCreateUpdateAccommodationConditionSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmAccommodationPledgeCreateUpdateAccommodationConditionSetupCompleted = true;
		}

		var numberOfBedsSelectInput = document.getElementById('frmAccommodationPledgeCreateUpdateNumberOfBeds');

		if (numberOfBedsSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "NumberOfBeds"
				},
				success: function( data ) {
					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
					unselectedOption.textContent = "Select Number of beds";
					numberOfBedsSelectInput.appendChild(unselectedOption);

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						numberOfBedsSelectInput.appendChild(el);
						frmAccommodationPledgeCreateUpdateNumberOfBedsSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmAccommodationPledgeCreateUpdateNumberOfBedsSetupCompleted = true;
		}

		var vacantOrSharedSelectInput = document.getElementById('frmAccommodationPledgeCreateUpdateVacantOrShared');

		if (vacantOrSharedSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "VacantOrShared"
				},
				success: function( data ) {
					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
					unselectedOption.textContent = "Select Vacant or Shared";
					vacantOrSharedSelectInput.appendChild(unselectedOption);

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						vacantOrSharedSelectInput.appendChild(el);
						frmAccommodationPledgeCreateUpdateVacantOrSharedSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmAccommodationPledgeCreateUpdateVacantOrSharedSetupCompleted = true;
		}



		// Reset all of the input contents.
		$( modal.find("input[type=text], input[type=tel], input[type=email], input[type=checkbox], textarea, select")).each(function(){
			var containerId = ('#').concat($(this).attr('id')).concat('FormGroup');
			var feedbackIconContainerId = ('#').concat($(this).attr('id')).concat('FeedbackIcon');
			var feedbackHelpBlockId = ('#').concat($(this).attr('id')).concat('HelpBlock');

			if ($(this).is('select')){
				var selectType = $(this).data('select-type');
				if (selectType == 'child'){
					removeSelectOptions(document.getElementById($(this).attr('id')));
				}
				else{
					$(this).val(-1);
				} 
			}
			else if ($(this).is(':checkbox')){
				$(this).prop('checked', false); 
			}
			else{
				$(this).val("");
			}
			//$(feedbackHelpBlockId).text('');
			$(containerId).toggleClass('has-warning', false);
			$(feedbackIconContainerId).toggleClass('glyphicon-warning-sign', false);
			$(containerId).toggleClass('has-success', false);
			$(feedbackIconContainerId).toggleClass('glyphicon-ok', false);
			$(containerId).toggleClass('has-error', false);
			$(feedbackIconContainerId).toggleClass('glyphicon-remove', false);
		});
		//reset the chosen selects
		var select = modal.find('#frmApplicationUserDetailsCreateUpdateAmenitiesSelect');
		select.find('option').prop('selected', false).end().trigger("chosen:updated");
		
		var select = modal.find('#frmApplicationUserDetailsCreateUpdateFacilitiesSelect');
		select.find('option').prop('selected', false).end().trigger("chosen:updated");
		
		var select = modal.find('#frmApplicationUserDetailsCreateUpdateAccommodateWhoSelect');
		select.find('option').prop('selected', false).end().trigger("chosen:updated");
		
		if (id != null){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/accommodationpledge",
				data: {
					id: id
				},
				success: function( data ) {
					//modal.find('#frmAccommodationPledgeCreateUpdateAddressOne').focus();

					modal.find('#frmAccommodationPledgeCreateUpdateAddressOne').val(data.addressOne);
					frmAccommodationPledgeCreateUpdateAddressOneBuffer = data.addressOne;

					modal.find('#frmAccommodationPledgeCreateUpdateAddressTwo').val(data.addressTwo);
					frmAccommodationPledgeCreateUpdateAddressTwoBuffer = data.addressTwo;

					modal.find('#frmAccommodationPledgeCreateUpdateCity').val(data.city);
					frmAccommodationPledgeCreateUpdateCityBuffer = data.city;

					modal.find('#frmAccommodationPledgeCreateUpdateStateProvinceRegion').val(data.stateProvinceRegion);
					frmAccommodationPledgeCreateUpdateStateProvinceRegionBuffer = data.stateProvinceRegion;

					modal.find('#frmAccommodationPledgeCreateUpdatePostCode').val(data.postCode);
					frmAccommodationPledgeCreateUpdatePostCodeBuffer = data.postCode;

					function frmAccommodationPledgeCreateUpdateCountryTimeOut() {
						setTimeout(function () {
							if (frmAccommodationPledgeCreateUpdateCountrySetupCompleted == false){
								frmAccommodationPledgeCreateUpdateCountryTimeOut();
							}
							else{
								if (data.country != null){
									countrySelectInput.value = data.country;
								}
								else{
									countrySelectInput.value = -1;
									frmAccommodationPledgeCreateUpdateCountryValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmAccommodationPledgeCreateUpdateCountryTimeOut();

					function frmAccommodationPledgeCreateUpdateOwnerOccupierTimeOut() {
						setTimeout(function () {
							if (frmAccommodationPledgeCreateUpdateOwnerOccupierSetupCompleted == false){
								frmAccommodationPledgeCreateUpdateOwnerOccupierTimeOut();
							}
							else{
								if (data.ownerOccupier != null){
									ownerOccupierSelectInput.value = data.ownerOccupier;
								}
								else{
									ownerOccupierSelectInput.value = -1;
									frmAccommodationPledgeCreateUpdateOwnerOccupierValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmAccommodationPledgeCreateUpdateOwnerOccupierTimeOut();

					modal.find('#frmAccommodationPledgeCreateUpdateAccommodationDateFrom').val(data.accommodationDateFrom);
					frmAccommodationPledgeCreateUpdateAccommodationDateFromBuffer = data.accommodationDateFrom;

					modal.find('#frmAccommodationPledgeCreateUpdateAccommodationDateTo').val(data.accommodationDateTo);
					frmAccommodationPledgeCreateUpdateAccommodationDateToBuffer = data.accommodationDateTo;

					function frmAccommodationPledgeCreateUpdateAccommodationTypeTimeOut() {
						setTimeout(function () {
							if (frmAccommodationPledgeCreateUpdateAccommodationTypeSetupCompleted == false){
								frmAccommodationPledgeCreateUpdateAccommodationTypeTimeOut();
							}
							else{
								if (data.accommodationType != null){
									accommodationTypeSelectInput.value = data.accommodationType;
								}
								else{
									accommodationTypeSelectInput.value = -1;
									frmAccommodationPledgeCreateUpdateAccommodationTypeValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmAccommodationPledgeCreateUpdateAccommodationTypeTimeOut();

					function frmAccommodationPledgeCreateUpdateAccommodationConditionTimeOut() {
						setTimeout(function () {
							if (frmAccommodationPledgeCreateUpdateAccommodationConditionSetupCompleted == false){
								frmAccommodationPledgeCreateUpdateAccommodationConditionTimeOut();
							}
							else{
								if (data.accommodationCondition != null){
									accommodationConditionSelectInput.value = data.accommodationCondition;
								}
								else{
									accommodationConditionSelectInput.value = -1;
									frmAccommodationPledgeCreateUpdateAccommodationConditionValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmAccommodationPledgeCreateUpdateAccommodationConditionTimeOut();

					function frmAccommodationPledgeCreateUpdateNumberOfBedsTimeOut() {
						setTimeout(function () {
							if (frmAccommodationPledgeCreateUpdateNumberOfBedsSetupCompleted == false){
								frmAccommodationPledgeCreateUpdateNumberOfBedsTimeOut();
							}
							else{
								if (data.numberOfBeds != null){
									numberOfBedsSelectInput.value = data.numberOfBeds;
								}
								else{
									numberOfBedsSelectInput.value = -1;
									frmAccommodationPledgeCreateUpdateNumberOfBedsValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmAccommodationPledgeCreateUpdateNumberOfBedsTimeOut();

					function frmAccommodationPledgeCreateUpdateVacantOrSharedTimeOut() {
						setTimeout(function () {
							if (frmAccommodationPledgeCreateUpdateVacantOrSharedSetupCompleted == false){
								frmAccommodationPledgeCreateUpdateVacantOrSharedTimeOut();
							}
							else{
								if (data.vacantOrShared != null){
									vacantOrSharedSelectInput.value = data.vacantOrShared;
								}
								else{
									vacantOrSharedSelectInput.value = -1;
									frmAccommodationPledgeCreateUpdateVacantOrSharedValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmAccommodationPledgeCreateUpdateVacantOrSharedTimeOut();

					modal.find('#frmAccommodationPledgeCreateUpdateOtherAmenities').val(data.otherAmenities);
					frmAccommodationPledgeCreateUpdateOtherAmenitiesBuffer = data.otherAmenities;

					function frmAccommodationPledgeCreateUpdateCanYouAccommodateTimeOut() {
						setTimeout(function () {
							if (frmAccommodationPledgeCreateUpdateCanYouAccommodateSetupCompleted == false){
								frmAccommodationPledgeCreateUpdateCanYouAccommodateTimeOut();
							}
							else{
								if (data.canYouAccommodate != null){
									canYouAccommodateSelectInput.value = data.canYouAccommodate;
								}
								else{
									canYouAccommodateSelectInput.value = -1;
									frmAccommodationPledgeCreateUpdateCanYouAccommodateValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmAccommodationPledgeCreateUpdateCanYouAccommodateTimeOut();

					modal.find('#frmAccommodationPledgeCreateUpdateAdditionalInformation').val(data.additionalInformation);
					frmAccommodationPledgeCreateUpdateAdditionalInformationBuffer = data.additionalInformation;

					// Display a count of the characters in the Description of other Amenities textarea input
					$('#frmAccommodationPledgeCreateUpdateOtherAmenitiesCountBlock').text($('#frmAccommodationPledgeCreateUpdateOtherAmenities').val().length.toString().concat('/').concat('500'));


					// Display a count of the characters in the Is there anything else that you would like to say about the accommodation? textarea input
					$('#frmAccommodationPledgeCreateUpdateAdditionalInformationCountBlock').text($('#frmAccommodationPledgeCreateUpdateAdditionalInformation').val().length.toString().concat('/').concat('500'));

					var select = modal.find('#frmApplicationUserDetailsCreateUpdateAmenitiesSelect');
					select.find('option').prop('selected', false);
					_.each(data.amenities, function(item){
						select.find('option[value="' + item + '"]').prop('selected', true).end().trigger('chosen:updated');
					});
					$('#frmApplicationUserDetailsCreateUpdateFacilitiesSelect').chosen();
					
					select = modal.find('#frmApplicationUserDetailsCreateUpdateFacilitiesSelect');
					select.find('option').prop('selected', false);
					_.each(data.facilities, function(item){
						select.find('option[value="' + item + '"]').prop('selected', true).end().trigger('chosen:updated');
					});
					$('#frmApplicationUserDetailsCreateUpdateFacilitiesSelect').chosen();
					
					
					var select = modal.find('#frmApplicationUserDetailsCreateUpdateAccommodateWhoSelect');
					select.find('option').prop('selected', false);
					_.each(data.accommodateWho, function(item){
						select.find('option[value="' + item + '"]').prop('selected', true).end().trigger('chosen:updated');
					});

					$('#frmApplicationUserDetailsCreateUpdateAccommodateWhoSelect').chosen();
				}
			});
		}


		// Display a count of the characters in the Description of other Amenities textarea input
		$('#frmAccommodationPledgeCreateUpdateOtherAmenitiesCountBlock').text($('#frmAccommodationPledgeCreateUpdateOtherAmenities').val().length.toString().concat('/').concat('500'));


		// Display a count of the characters in the Is there anything else that you would like to say about the accommodation? textarea input
		$('#frmAccommodationPledgeCreateUpdateAdditionalInformationCountBlock').text($('#frmAccommodationPledgeCreateUpdateAdditionalInformation').val().length.toString().concat('/').concat('500'));


	});	

	$('#accommodationPledgeCreateUpdateModal').on('shown.bs.modal', function (event) {
		if (frmAccommodationPledgeCreateUpdateLaddaSubmitButtonHandler != null){
			frmAccommodationPledgeCreateUpdateLaddaSubmitButtonHandler.stop();
		}
		$('#frmAccommodationPledgeCreateUpdateAddressOne').focus();
		debugger;
		$('#frmApplicationUserDetailsCreateUpdateAmenitiesSelect').chosen();
		$('#frmApplicationUserDetailsCreateUpdateFacilitiesSelect').chosen();
		$('#frmApplicationUserDetailsCreateUpdateAccommodateWhoSelect').chosen();
	});	


	$("#frmAccommodationPledgeCreateUpdateSubmitButton").click(function( event ) {
		frmAccommodationPledgeCreateUpdateLaddaSubmitButtonHandler.start();
		var validationSuccess = true;
		var mode = null;
		var modal = $('#accommodationPledgeCreateUpdateModal');
		var modalTitle = modal.find('#frmAccommodationPledgeCreateUpdateTitle').val();
		var callBackDisplayType = modal.find('#frmAccommodationPledgeCreateUpdateCallBackDisplayType').val();

		$( modal.find("input[type=text], input[type=tel], input[type=email], input[type=checkbox][aria-describedby], textarea, select")).each(function(){
			var containerId = ('#').concat($(this).attr('id')).concat('FormGroup');
			var feedbackIconContainerId = ('#').concat($(this).attr('id')).concat('FeedbackIcon');
			var feedbackAlertBlockId = ('#').concat($(this).attr('id')).concat('AlertBlock');
			var feedbackAlertBlockTextId = ('#').concat($(this).attr('id')).concat('AlertBlockText');
			var feedbackHelpBlockId = ('#').concat($(this).attr('id')).concat('HelpBlock');

			if ($(this).data('required') == true){
				if ( ( !$(this).is(':checkbox') && ($(this).val() == -1 || $(this).val() == '') ) || ( $(this).is(':checkbox') && !$(this).is(':checked') ) ){
					if ($(this).is(':checkbox')){
						$(feedbackHelpBlockId).text('Please check the ' + $(this).data('display-name') + ' checkbox');
						//showalert(feedbackAlertBlockId, feedbackAlertBlockTextId, 'Please check the ' + $(this).data('display-name') + ' checkbox', 'alert-danger')    					
					}else{
						$(feedbackHelpBlockId).text('Please enter a value for ' + $(this).data('display-name'));
						//showalert(feedbackAlertBlockId, feedbackAlertBlockTextId, 'Please enter a value for ' + $(this).data('display-name'), 'alert-danger')
					}
					$(containerId).toggleClass('has-error', true);
					if (!$(this).is(':checkbox')){

						$(feedbackIconContainerId).toggleClass('glyphicon-remove', true);
					}
					validationSuccess = false;
				}
			}
		});
		
		if (validationSuccess == false){
			frmAccommodationPledgeCreateUpdateLaddaSubmitButtonHandler.stop();
			return false;
		}


		if (modal.find('#frmAccommodationPledgeCreateUpdateLoadedObjectId').val().length > 0){
			mode = "update";
		}
		else{
			mode="new";
		}

		var accommodationPledge = {
				parentObjectId : modal.find('#frmAccommodationPledgeCreateUpdateParentObjectId').val(),
				id : modal.find('#frmAccommodationPledgeCreateUpdateLoadedObjectId').val(),
				addressOne : modal.find('#frmAccommodationPledgeCreateUpdateAddressOne').val(),
				addressTwo : modal.find('#frmAccommodationPledgeCreateUpdateAddressTwo').val(),
				city : modal.find('#frmAccommodationPledgeCreateUpdateCity').val(),
				stateProvinceRegion : modal.find('#frmAccommodationPledgeCreateUpdateStateProvinceRegion').val(),
				postCode : modal.find('#frmAccommodationPledgeCreateUpdatePostCode').val(),
				country : modal.find('#frmAccommodationPledgeCreateUpdateCountry').val(),
				ownerOccupier : modal.find('#frmAccommodationPledgeCreateUpdateOwnerOccupier').val(),
				accommodationDateFrom : modal.find('#frmAccommodationPledgeCreateUpdateAccommodationDateFrom').val(),
				accommodationDateTo : modal.find('#frmAccommodationPledgeCreateUpdateAccommodationDateTo').val(),
				accommodationType : modal.find('#frmAccommodationPledgeCreateUpdateAccommodationType').val(),
				accommodationCondition : modal.find('#frmAccommodationPledgeCreateUpdateAccommodationCondition').val(),
				numberOfBeds : modal.find('#frmAccommodationPledgeCreateUpdateNumberOfBeds').val(),
				vacantOrShared : modal.find('#frmAccommodationPledgeCreateUpdateVacantOrShared').val(),
				facilities : _.map(modal.find('#frmApplicationUserDetailsCreateUpdateFacilitiesSelect').val(), Number),
				amenities : _.map(modal.find('#frmApplicationUserDetailsCreateUpdateAmenitiesSelect').val(), Number),
				otherAmenities : modal.find('#frmAccommodationPledgeCreateUpdateOtherAmenities').val(),
				accommodateWho : _.map(modal.find('#frmApplicationUserDetailsCreateUpdateAccommodateWhoSelect').val(), Number),
				additionalInformation : modal.find('#frmAccommodationPledgeCreateUpdateAdditionalInformation').val()
		};

		var propertyUrl = modal.find('#frmAccommodationPledgeCreateUpdatePropertyUrl').val();
		var url = rootContext + "/restful/registerofpledges/" + propertyUrl + "/" + mode;

		$.ajax({
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			method: "post",
			url: url,
			data: JSON.stringify(accommodationPledge),
			success: function( data ) {
				if ( ($('#frmRegisterOfPledgesMode').val() == 'ADD') || ($('#frmRegisterOfPledgesMode').val() == 'UPDATE')){
					if (callBackDisplayType == "table"){
						var new_tbody = document.createElement('tbody');
						var callBackTableBodyId = modal.find('#frmAccommodationPledgeCreateUpdateCallBackTableBodyId').val();
						var callBackTableBody = document.getElementById(callBackTableBodyId);

						$.each(data, function(idx, obj) {
							var row = document.createElement("tr");
							var cell = document.createElement("td");
							var editModalAnchorText = "<a href='#' class='btn btn-info btn-sm' data-toggle='modal' data-backdrop='static' data-target='#accommodationPledgeCreateUpdateModal' data-id='" + obj.id + "' data-modal-title='" + modalTitle + "' data-callback-table-body-id='" + callBackTableBodyId + "' data-property-url='accommodationpledges' data-callback-display-type='table' aria-label='view'><span class='glyphicon glyphicon-edit'></a>";
							var editAnchorURI = rootContext + "/accommodationpledge/" + obj.id + "/update";
							var editAnchorText = "<a href='" + editAnchorURI + "' class='btn btn-primary btn-sm' aria-label='view'><span class='glyphicon glyphicon-pencil'></a>";
							cell.innerHTML = "<div class='btn-group-vertical' role='group'>" + editModalAnchorText  + "</div>";
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.accommodationTypeReferenceTranslation);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.accommodationConditionReferenceTranslation);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.numberOfBedsReferenceTranslation);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.vacantOrSharedReferenceTranslation);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.canYouAccommodateReferenceTranslation);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.accommodationDateFrom);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.accommodationDateTo);
							cell.appendChild(cellText);
							row.appendChild(cell);

							new_tbody.appendChild(row);
						});

						callBackTableBody.parentNode.replaceChild(new_tbody, callBackTableBody);
						new_tbody.id = callBackTableBodyId;
					}
					else if (callBackDisplayType == "inline"){
						$.each(data, function(idx, obj) {

							document.getElementById("frmAccommodationPledgeAccommodationTypeMessage").innerHTML = obj.accommodationTypeReferenceTranslation;

							document.getElementById("frmAccommodationPledgeAccommodationConditionMessage").innerHTML = obj.accommodationConditionReferenceTranslation;

							document.getElementById("frmAccommodationPledgeNumberOfBedsMessage").innerHTML = obj.numberOfBedsReferenceTranslation;

							document.getElementById("frmAccommodationPledgeVacantOrSharedMessage").innerHTML = obj.vacantOrSharedReferenceTranslation;

							document.getElementById("frmAccommodationPledgeCanYouAccommodateMessage").innerHTML = obj.canYouAccommodateReferenceTranslation;

							document.getElementById("frmAccommodationPledgeAccommodationDateFromMessage").innerHTML = obj.accommodationDateFrom;

							document.getElementById("frmAccommodationPledgeAccommodationDateToMessage").innerHTML = obj.accommodationDateTo;

						});
					}
				}

				modal.modal('hide');
			},
			error: function(jqXHR, textStatus, errorThrown) {
				if(jqXHR.status==403) {
					alert('403 returned');
				}

				console.log(textStatus, errorThrown);
			}
		});
	});


	$("#frmAccommodationPledgeCreateUpdateCloseButton").click(function( event ) {
		var mode = null;
		var modal = $('#accommodationPledgeCreateUpdateModal');
		var callBackTableBodyId = modal.find('#frmAccommodationPledgeCreateUpdateCallBackTableBodyId').val();
		var callBackTableBody = document.getElementById(callBackTableBodyId);
		var modalTitle = modal.find('#frmAccommodationPledgeCreateUpdateTitle').val();


		modal.modal('hide');
	});





	var frmServicePledgeCreateUpdateLaddaSubmitButtonHandler = null;


	$('#servicePledgeCreateUpdateModal').modal('handleUpdate');

	$('#servicePledgeCreateUpdateModal').on('show.bs.modal', function (event) {
		var button = $(event.relatedTarget); // Button that triggered the modal
		var id = button.data('id'); // Extract info from data-* attributes
		var modalTitle = button.data('modal-title');
		var callBackDisplayType = button.data('callback-display-type');
		var callBackTableId = button.data('callback-table-body-id');
		var propertyUrl = button.data('property-url');

		var modal = $(this);
		modal.find('.modal-title').text(modalTitle);
		modal.find('#frmServicePledgeCreateUpdateLoadedObjectId').val(id);
		modal.find('#frmServicePledgeCreateUpdateParentObjectId').val(mainFormObjectId);
		modal.find('#frmServicePledgeCreateUpdateCallBackDisplayType').val(callBackDisplayType);
		modal.find('#frmServicePledgeCreateUpdateCallBackTableBodyId').val(callBackTableId);
		modal.find('#frmServicePledgeCreateUpdatePropertyUrl').val(propertyUrl);


		if (mainFormObjectId == ''){
			var invalidParentIdMessage = button.data('invalid-parent-id-message'); // Extract info from data-* attributes
			$('#servicePledgeCreateUpdateModal').find('.modal-body').html('<p>' + invalidParentIdMessage + '</p>');
			$("#frmServicePledgeCreateUpdateSubmitButton").hide();
			return;
		}

		if (frmServicePledgeCreateUpdateLaddaSubmitButtonHandler == null){
			frmServicePledgeCreateUpdateLaddaSubmitButtonHandler = Ladda.create(document.querySelector("#frmServicePledgeCreateUpdateSubmitButton"));
		}

		frmServicePledgeCreateUpdateLaddaSubmitButtonHandler.start();


		var pledgeServiceLevelOneSelectInput = document.getElementById('frmServicePledgeCreateUpdatePledgeServiceLevelOne');

		if (pledgeServiceLevelOneSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "PledgeServiceLevelOne"
				},
				success: function( data ) {
					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
					unselectedOption.textContent = "Select Your Service";
					pledgeServiceLevelOneSelectInput.appendChild(unselectedOption);

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						pledgeServiceLevelOneSelectInput.appendChild(el);
						frmServicePledgeCreateUpdatePledgeServiceLevelOneSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmServicePledgeCreateUpdatePledgeServiceLevelOneSetupCompleted = true;
		}

		var pledgeServiceLevelTwoSelectInput = document.getElementById('frmServicePledgeCreateUpdatePledgeServiceLevelTwo');

		if (pledgeServiceLevelTwoSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "PledgeServiceLevelTwo"
				},
				success: function( data ) {
					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
					unselectedOption.textContent = "Select ";
					pledgeServiceLevelTwoSelectInput.appendChild(unselectedOption);

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						pledgeServiceLevelTwoSelectInput.appendChild(el);
						frmServicePledgeCreateUpdatePledgeServiceLevelTwoSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmServicePledgeCreateUpdatePledgeServiceLevelTwoSetupCompleted = true;
		}

		var pledgeServiceLevelThreeSelectInput = document.getElementById('frmServicePledgeCreateUpdatePledgeServiceLevelThree');

		if (pledgeServiceLevelThreeSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "PledgeServiceLevelThree"
				},
				success: function( data ) {
					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
					unselectedOption.textContent = "Select ";
					pledgeServiceLevelThreeSelectInput.appendChild(unselectedOption);

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						pledgeServiceLevelThreeSelectInput.appendChild(el);
						frmServicePledgeCreateUpdatePledgeServiceLevelThreeSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmServicePledgeCreateUpdatePledgeServiceLevelThreeSetupCompleted = true;
		}

		var pledgeServiceHoursPerWeekSelectInput = document.getElementById('frmServicePledgeCreateUpdatePledgeServiceHoursPerWeek');

		if (pledgeServiceHoursPerWeekSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "IntegerCount1to40"
				},
				success: function( data ) {
					var unselectedOption = document.createElement("option");
					unselectedOption.value = -1;
					unselectedOption.textContent = "Select Hours per week";
					pledgeServiceHoursPerWeekSelectInput.appendChild(unselectedOption);

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						pledgeServiceHoursPerWeekSelectInput.appendChild(el);
						frmServicePledgeCreateUpdatePledgeServiceHoursPerWeekSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmServicePledgeCreateUpdatePledgeServiceHoursPerWeekSetupCompleted = true;
		}


		// Reset all of the input contents.
		$( modal.find("input[type=text], input[type=tel], input[type=email], input[type=checkbox], textarea, select")).each(function(){
			var containerId = ('#').concat($(this).attr('id')).concat('FormGroup');
			var feedbackIconContainerId = ('#').concat($(this).attr('id')).concat('FeedbackIcon');
			var feedbackHelpBlockId = ('#').concat($(this).attr('id')).concat('HelpBlock');

			if ($(this).is('select')){
				var selectType = $(this).data('select-type');
				if (selectType == 'child'){
					removeSelectOptions(document.getElementById($(this).attr('id')));
				}
				else{
					$(this).val(-1);
				} 
			}
			else if ($(this).is(':checkbox')){
				$(this).prop('checked', false); 
			}
			else{
				$(this).val("");
			}
			//$(feedbackHelpBlockId).text('');
			$(containerId).toggleClass('has-warning', false);
			$(feedbackIconContainerId).toggleClass('glyphicon-warning-sign', false);
			$(containerId).toggleClass('has-success', false);
			$(feedbackIconContainerId).toggleClass('glyphicon-ok', false);
			$(containerId).toggleClass('has-error', false);
			$(feedbackIconContainerId).toggleClass('glyphicon-remove', false);
		});

		if (id != null){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/servicepledge",
				data: {
					id: id
				},
				success: function( data ) {

					//modal.find('#frmServicePledgeCreateUpdatePledgeServiceLevelOne').focus();

					function frmServicePledgeCreateUpdatePledgeServiceLevelOneTimeOut() {
						setTimeout(function () {
							if (frmServicePledgeCreateUpdatePledgeServiceLevelOneSetupCompleted == false){
								frmServicePledgeCreateUpdatePledgeServiceLevelOneTimeOut();
							}
							else{
								if (data.pledgeServiceLevelOne != null){
									pledgeServiceLevelOneSelectInput.value = data.pledgeServiceLevelOne;
								}
								else{
									pledgeServiceLevelOneSelectInput.value = -1;
									frmServicePledgeCreateUpdatePledgeServiceLevelOneValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmServicePledgeCreateUpdatePledgeServiceLevelOneTimeOut();

					function frmServicePledgeCreateUpdatePledgeServiceLevelTwoTimeOut() {
						setTimeout(function () {
							if (frmServicePledgeCreateUpdatePledgeServiceLevelTwoSetupCompleted == false){
								frmServicePledgeCreateUpdatePledgeServiceLevelTwoTimeOut();
							}
							else{
								if (data.pledgeServiceLevelTwo != null){
									pledgeServiceLevelTwoSelectInput.value = data.pledgeServiceLevelTwo;
									var formGroupId = pledgeServiceLevelTwoSelectInput.id.concat('FormGroup');
									$('#' + formGroupId).collapse('show');

								}
								else{
									pledgeServiceLevelTwoSelectInput.value = -1;
									frmServicePledgeCreateUpdatePledgeServiceLevelTwoValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmServicePledgeCreateUpdatePledgeServiceLevelTwoTimeOut();

					function frmServicePledgeCreateUpdatePledgeServiceLevelThreeTimeOut() {
						setTimeout(function () {
							if (frmServicePledgeCreateUpdatePledgeServiceLevelThreeSetupCompleted == false){
								frmServicePledgeCreateUpdatePledgeServiceLevelThreeTimeOut();
							}
							else{
								if (data.pledgeServiceLevelThree != null){
									pledgeServiceLevelThreeSelectInput.value = data.pledgeServiceLevelThree;
									var formGroupId = pledgeServiceLevelThreeSelectInput.id.concat('FormGroup');
									$('#' + formGroupId).collapse('show');

								}
								else{
									pledgeServiceLevelThreeSelectInput.value = -1;
									frmServicePledgeCreateUpdatePledgeServiceLevelThreeValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmServicePledgeCreateUpdatePledgeServiceLevelThreeTimeOut();

					modal.find('#frmServicePledgeCreateUpdateAdditionalInformation').val(data.additionalInformation);
					frmServicePledgeCreateUpdateAdditionalInformationBuffer = data.additionalInformation;

					modal.find('#frmServicePledgeCreateUpdatePledgeServiceQualification').val(data.pledgeServiceQualification);
					frmServicePledgeCreateUpdatePledgeServiceQualificationBuffer = data.pledgeServiceQualification;

					modal.find('#frmServicePledgeCreateUpdatePledgeServiceDateAvailable').val(data.pledgeServiceDateAvailable);
					frmServicePledgeCreateUpdatePledgeServiceDateAvailableBuffer = data.pledgeServiceDateAvailable;

					modal.find('#frmServicePledgeCreateUpdatePledgeServiceDateAvailableTo').val(data.pledgeServiceDateAvailableTo);
					frmServicePledgeCreateUpdatePledgeServiceDateAvailableToBuffer = data.pledgeServiceDateAvailableTo;

					function frmServicePledgeCreateUpdatePledgeServiceHoursPerWeekTimeOut() {
						setTimeout(function () {
							if (frmServicePledgeCreateUpdatePledgeServiceHoursPerWeekSetupCompleted == false){
								frmServicePledgeCreateUpdatePledgeServiceHoursPerWeekTimeOut();
							}
							else{
								if (data.pledgeServiceHoursPerWeek != null){
									pledgeServiceHoursPerWeekSelectInput.value = data.pledgeServiceHoursPerWeek;
								}
								else{
									pledgeServiceHoursPerWeekSelectInput.value = -1;
									frmServicePledgeCreateUpdatePledgeServiceHoursPerWeekValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmServicePledgeCreateUpdatePledgeServiceHoursPerWeekTimeOut();

					// Display a count of the characters in the Additional Information textarea input
					$('#frmServicePledgeCreateUpdateAdditionalInformationCountBlock').text($('#frmServicePledgeCreateUpdateAdditionalInformation').val().length.toString().concat('/').concat('500'));


					// Display a count of the characters in the Qualification to provide Service textarea input
					$('#frmServicePledgeCreateUpdatePledgeServiceQualificationCountBlock').text($('#frmServicePledgeCreateUpdatePledgeServiceQualification').val().length.toString().concat('/').concat('500'));


				}
			});
		}

		// Display a count of the characters in the Additional Information textarea input
		$('#frmServicePledgeCreateUpdateAdditionalInformationCountBlock').text($('#frmServicePledgeCreateUpdateAdditionalInformation').val().length.toString().concat('/').concat('500'));

		// Display a count of the characters in the Qualification to provide Service textarea input
		$('#frmServicePledgeCreateUpdatePledgeServiceQualificationCountBlock').text($('#frmServicePledgeCreateUpdatePledgeServiceQualification').val().length.toString().concat('/').concat('500'));


	});	

	$('#servicePledgeCreateUpdateModal').on('shown.bs.modal', function (event) {
		if (frmServicePledgeCreateUpdateLaddaSubmitButtonHandler != null){
			frmServicePledgeCreateUpdateLaddaSubmitButtonHandler.stop();
		}
		$('#frmServicePledgeCreateUpdatePledgeServiceLevelOne').focus()
	});	



	$("#frmServicePledgeCreateUpdateSubmitButton").click(function( event ) {
		frmServicePledgeCreateUpdateLaddaSubmitButtonHandler.start();
		var validationSuccess = true;
		var mode = null;
		var modal = $('#servicePledgeCreateUpdateModal');
		var modalTitle = modal.find('#frmServicePledgeCreateUpdateTitle').val();
		var callBackDisplayType = modal.find('#frmServicePledgeCreateUpdateCallBackDisplayType').val();

		$( modal.find("input[type=text], input[type=tel], input[type=email], input[type=checkbox][aria-describedby], textarea, select")).each(function(){
			var containerId = ('#').concat($(this).attr('id')).concat('FormGroup');
			var feedbackIconContainerId = ('#').concat($(this).attr('id')).concat('FeedbackIcon');
			var feedbackAlertBlockId = ('#').concat($(this).attr('id')).concat('AlertBlock');
			var feedbackAlertBlockTextId = ('#').concat($(this).attr('id')).concat('AlertBlockText');
			var feedbackHelpBlockId = ('#').concat($(this).attr('id')).concat('HelpBlock');

			if ($(this).data('required') == true){
				if ( ( !$(this).is(':checkbox') && ($(this).val() == -1 || $(this).val() == '') ) || ( $(this).is(':checkbox') && !$(this).is(':checked') ) ){
					if ($(this).is(':checkbox')){
						$(feedbackHelpBlockId).text('Please check the ' + $(this).data('display-name') + ' checkbox');
						//showalert(feedbackAlertBlockId, feedbackAlertBlockTextId, 'Please check the ' + $(this).data('display-name') + ' checkbox', 'alert-danger')    					
					}else{
						$(feedbackHelpBlockId).text('Please enter a value for ' + $(this).data('display-name'));
						//showalert(feedbackAlertBlockId, feedbackAlertBlockTextId, 'Please enter a value for ' + $(this).data('display-name'), 'alert-danger')
					}
					$(containerId).toggleClass('has-error', true);
					if (!$(this).is(':checkbox')){
						$(feedbackIconContainerId).toggleClass('glyphicon-remove', true);
					}
					validationSuccess = false;
				}
			}

		});

		if (validationSuccess == false){
			frmServicePledgeCreateUpdateLaddaSubmitButtonHandler.stop();
			return false;
		}


		if (modal.find('#frmServicePledgeCreateUpdateLoadedObjectId').val().length > 0){
			mode = "update";
		}
		else{
			mode="new";
		}




		var servicePledge = {
				parentObjectId : modal.find('#frmServicePledgeCreateUpdateParentObjectId').val(),
				id : modal.find('#frmServicePledgeCreateUpdateLoadedObjectId').val(),
				pledgeServiceLevelOne : modal.find('#frmServicePledgeCreateUpdatePledgeServiceLevelOne').val(),
				pledgeServiceLevelTwo : modal.find('#frmServicePledgeCreateUpdatePledgeServiceLevelTwo').val(),
				pledgeServiceLevelThree : modal.find('#frmServicePledgeCreateUpdatePledgeServiceLevelThree').val(),
				additionalInformation : modal.find('#frmServicePledgeCreateUpdateAdditionalInformation').val(),
				pledgeServiceQualification : modal.find('#frmServicePledgeCreateUpdatePledgeServiceQualification').val(),
				pledgeServiceDateAvailable : modal.find('#frmServicePledgeCreateUpdatePledgeServiceDateAvailable').val(),
				pledgeServiceDateAvailableTo : modal.find('#frmServicePledgeCreateUpdatePledgeServiceDateAvailableTo').val(),
				pledgeServiceHoursPerWeek : modal.find('#frmServicePledgeCreateUpdatePledgeServiceHoursPerWeek').val()
		};

		var propertyUrl = modal.find('#frmServicePledgeCreateUpdatePropertyUrl').val();
		var url = rootContext + "/restful/registerofpledges/" + propertyUrl + "/" + mode;

		$.ajax({
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			method: "post",
			url: url,
			data: JSON.stringify(servicePledge),
			success: function( data ) {
				if ( ($('#frmRegisterOfPledgesMode').val() == 'ADD') || ($('#frmRegisterOfPledgesMode').val() == 'UPDATE')){
					if (callBackDisplayType == "table"){
						var new_tbody = document.createElement('tbody');
						var callBackTableBodyId = modal.find('#frmServicePledgeCreateUpdateCallBackTableBodyId').val();
						var callBackTableBody = document.getElementById(callBackTableBodyId);

						$.each(data, function(idx, obj) {
							var row = document.createElement("tr");
							var cell = document.createElement("td");
							var editModalAnchorText = "<a href='#' class='btn btn-info btn-sm' data-toggle='modal' data-backdrop='static' data-target='#servicePledgeCreateUpdateModal' data-id='" + obj.id + "' data-modal-title='" + modalTitle + "' data-callback-table-body-id='" + callBackTableBodyId + "' data-property-url='servicepledges' data-callback-display-type='table' aria-label='view'><span class='glyphicon glyphicon-edit'></a>";
							var editAnchorURI = rootContext + "/servicepledge/" + obj.id + "/update";
							var editAnchorText = "<a href='" + editAnchorURI + "' class='btn btn-primary btn-sm' aria-label='view'><span class='glyphicon glyphicon-pencil'></a>";
							cell.innerHTML = "<div class='btn-group-vertical' role='group'>" + editModalAnchorText  + "</div>";
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.pledgeServiceDateAvailable);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.pledgeServiceDateAvailableTo);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.pledgeServiceLevelOneReferenceTranslation);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.pledgeServiceLevelTwoReferenceTranslation);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.pledgeServiceLevelThreeReferenceTranslation);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.pledgeServiceQualification);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.additionalInformation);
							cell.appendChild(cellText);
							row.appendChild(cell);

							new_tbody.appendChild(row);
						});

						callBackTableBody.parentNode.replaceChild(new_tbody, callBackTableBody);
						new_tbody.id = callBackTableBodyId;
					}
					else if (callBackDisplayType == "inline"){
						$.each(data, function(idx, obj) {

							document.getElementById("frmServicePledgePledgeServiceDateAvailableMessage").innerHTML = obj.pledgeServiceDateAvailable;

							document.getElementById("frmServicePledgePledgeServiceLevelOneMessage").innerHTML = obj.pledgeServiceLevelOneReferenceTranslation;

							document.getElementById("frmServicePledgePledgeServiceLevelTwoMessage").innerHTML = obj.pledgeServiceLevelTwoReferenceTranslation;

							document.getElementById("frmServicePledgePledgeServiceLevelThreeMessage").innerHTML = obj.pledgeServiceLevelThreeReferenceTranslation;

							document.getElementById("frmServicePledgePledgeServiceQualificationMessage").innerHTML = obj.pledgeServiceQualification;

							document.getElementById("frmServicePledgeAdditionalInformationMessage").innerHTML = obj.additionalInformation;

						});
					}
				}

				modal.modal('hide');
			},
			error: function(jqXHR, textStatus, errorThrown) {
				if(jqXHR.status==403) {
					alert('403 returned');
				}

				console.log(textStatus, errorThrown);
			}
		});
	});

	$("#frmServicePledgeCreateUpdateCloseButton").click(function( event ) {
		var mode = null;
		var modal = $('#servicePledgeCreateUpdateModal');
		var callBackTableBodyId = modal.find('#frmServicePledgeCreateUpdateCallBackTableBodyId').val();
		var callBackTableBody = document.getElementById(callBackTableBodyId);
		var modalTitle = modal.find('#frmServicePledgeCreateUpdateTitle').val();


		modal.modal('hide');
	});

	var frmGoodsPledgeCreateUpdateLaddaSubmitButtonHandler = null;


	$('#goodsPledgeCreateUpdateModal').modal('handleUpdate');

	$('#goodsPledgeCreateUpdateModal').on('show.bs.modal', function (event) {
		var button = $(event.relatedTarget); // Button that triggered the modal
		var id = button.data('id'); // Extract info from data-* attributes
		var modalTitle = button.data('modal-title');
		var callBackDisplayType = button.data('callback-display-type');
		var callBackTableId = button.data('callback-table-body-id');
		var propertyUrl = button.data('property-url');

		var modal = $(this);
		modal.find('.modal-title').text(modalTitle);
		modal.find('#frmGoodsPledgeCreateUpdateLoadedObjectId').val(id);
		modal.find('#frmGoodsPledgeCreateUpdateParentObjectId').val(mainFormObjectId);
		modal.find('#frmGoodsPledgeCreateUpdateCallBackDisplayType').val(callBackDisplayType);
		modal.find('#frmGoodsPledgeCreateUpdateCallBackTableBodyId').val(callBackTableId);
		modal.find('#frmGoodsPledgeCreateUpdatePropertyUrl').val(propertyUrl);


		if (mainFormObjectId == ''){
			var invalidParentIdMessage = button.data('invalid-parent-id-message'); // Extract info from data-* attributes
			$('#goodsPledgeCreateUpdateModal').find('.modal-body').html('<p>' + invalidParentIdMessage + '</p>');
			$("#frmGoodsPledgeCreateUpdateSubmitButton").hide();
			return;
		}

		if (frmGoodsPledgeCreateUpdateLaddaSubmitButtonHandler == null){
			frmGoodsPledgeCreateUpdateLaddaSubmitButtonHandler = Ladda.create(document.querySelector("#frmGoodsPledgeCreateUpdateSubmitButton"));
		}

		frmGoodsPledgeCreateUpdateLaddaSubmitButtonHandler.start();


		var goodsCategoryOneSelectInput = document.getElementById('frmGoodsPledgeCreateUpdateGoodsCategoryOne');

		if (goodsCategoryOneSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "GoodsCategoryOne"
				},
				success: function( data ) {
					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						goodsCategoryOneSelectInput.appendChild(el);
						frmGoodsPledgeCreateUpdateGoodsCategoryOneSetupCompleted = true;
					});

				}
			});
		}
		else{
			frmGoodsPledgeCreateUpdateGoodsCategoryOneSetupCompleted = true;
		}
		goodsCategoryOneSelectInput.selectedIndex = 0;

		var goodsCategoryTwoSelectInput = document.getElementById('frmGoodsPledgeCreateUpdateGoodsCategoryTwo');

		if (goodsCategoryTwoSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "GoodsCategoryTwo"
				},
				success: function( data ) {
					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						goodsCategoryTwoSelectInput.appendChild(el);
						frmGoodsPledgeCreateUpdateGoodsCategoryTwoSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmGoodsPledgeCreateUpdateGoodsCategoryTwoSetupCompleted = true;
		}

		var goodsCategoryThreeSelectInput = document.getElementById('frmGoodsPledgeCreateUpdateGoodsCategoryThree');

		if (goodsCategoryThreeSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "GoodsCategoryThree"
				},
				success: function( data ) {

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						goodsCategoryThreeSelectInput.appendChild(el);
						frmGoodsPledgeCreateUpdateGoodsCategoryThreeSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmGoodsPledgeCreateUpdateGoodsCategoryThreeSetupCompleted = true;
		}

		var goodsSizeSelectInput = document.getElementById('frmGoodsPledgeCreateUpdateGoodsSize');

		if (goodsSizeSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "GoodsSize"
				},
				success: function( data ) {

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						goodsSizeSelectInput.appendChild(el);
						frmGoodsPledgeCreateUpdateGoodsSizeSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmGoodsPledgeCreateUpdateGoodsSizeSetupCompleted = true;
		}

		var goodsNewOrUsedSelectInput = document.getElementById('frmGoodsPledgeCreateUpdateGoodsNewOrUsed');

		if (goodsNewOrUsedSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "NewOrUsed"
				},
				success: function( data ) {

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						goodsNewOrUsedSelectInput.appendChild(el);
						frmGoodsPledgeCreateUpdateGoodsNewOrUsedSetupCompleted = true;
					});
					goodsNewOrUsedSelectInput.selectedIndex = 0;
				}
			});
		}
		else{
			frmGoodsPledgeCreateUpdateGoodsNewOrUsedSetupCompleted = true;
		}

		var goodsConditionSelectInput = document.getElementById('frmGoodsPledgeCreateUpdateGoodsCondition');

		if (goodsConditionSelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "GoodsCondition"
				},
				success: function( data ) {

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						goodsConditionSelectInput.appendChild(el);
						frmGoodsPledgeCreateUpdateGoodsConditionSetupCompleted = true;
					});
				}
			});
		}
		else{
			frmGoodsPledgeCreateUpdateGoodsConditionSetupCompleted = true;
		}

		var goodsQuantitySelectInput = document.getElementById('frmGoodsPledgeCreateUpdateGoodsQuantity');

		if (goodsQuantitySelectInput.length == 0){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/referenceslist",
				data: {
					referenceType: "GoodsQuantity"
				},
				success: function( data ) {

					$.each( data, function( key, val ) {
						var el = document.createElement("option");
						el.textContent = val;
						el.value = key;

						goodsQuantitySelectInput.appendChild(el);
						frmGoodsPledgeCreateUpdateGoodsQuantitySetupCompleted = true;
					});
				}
			});
		}
		else{
			frmGoodsPledgeCreateUpdateGoodsQuantitySetupCompleted = true;
		}


		// Reset all of the input contents.
		$( modal.find("input[type=text], input[type=tel], input[type=email], input[type=checkbox], textarea, select")).each(function(){
			var containerId = ('#').concat($(this).attr('id')).concat('FormGroup');
			var feedbackIconContainerId = ('#').concat($(this).attr('id')).concat('FeedbackIcon');
			var feedbackHelpBlockId = ('#').concat($(this).attr('id')).concat('HelpBlock');

			if ($(this).is('select')){
				var selectType = $(this).data('select-type');
				if (selectType == 'child'){
					removeSelectOptions(document.getElementById($(this).attr('id')));
				}
				else{
					$(this).val(-1);
				} 
			}
			else if ($(this).is(':checkbox')){
				$(this).prop('checked', false); 
			}
			else{
				$(this).val("");
			}
			//$(feedbackHelpBlockId).text('');
			$(containerId).toggleClass('has-warning', false);
			$(feedbackIconContainerId).toggleClass('glyphicon-warning-sign', false);
			$(containerId).toggleClass('has-success', false);
			$(feedbackIconContainerId).toggleClass('glyphicon-ok', false);
			$(containerId).toggleClass('has-error', false);
			$(feedbackIconContainerId).toggleClass('glyphicon-remove', false);
		});

		if (id != null){
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/goodspledge",
				data: {
					id: id
				},
				success: function( data ) {

					//modal.find('#frmGoodsPledgeCreateUpdateGoodsCategoryOne').focus();

					function frmGoodsPledgeCreateUpdateGoodsCategoryOneTimeOut() {
						setTimeout(function () {
							if (frmGoodsPledgeCreateUpdateGoodsCategoryOneSetupCompleted == false){
								frmGoodsPledgeCreateUpdateGoodsCategoryOneTimeOut();
							}
							else{
								if (data.goodsCategoryOne != null){
									goodsCategoryOneSelectInput.value = data.goodsCategoryOne;
								}
								else{
									goodsCategoryOneSelectInput.selectedIndex = 0;
									//frmGoodsPledgeCreateUpdateGoodsCategoryOneValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmGoodsPledgeCreateUpdateGoodsCategoryOneTimeOut();

					function frmGoodsPledgeCreateUpdateGoodsCategoryTwoTimeOut() {
						setTimeout(function () {
							if (frmGoodsPledgeCreateUpdateGoodsCategoryTwoSetupCompleted == false){
								frmGoodsPledgeCreateUpdateGoodsCategoryTwoTimeOut();
							}
							else{
								if (data.goodsCategoryTwo != null){
									goodsCategoryTwoSelectInput.value = data.goodsCategoryTwo;
									var formGroupId = goodsCategoryTwoSelectInput.id.concat('FormGroup');
									$('#' + formGroupId).collapse('show');
								}
								else{
									goodsCategoryTwoSelectInput.value = -1;
									frmGoodsPledgeCreateUpdateGoodsCategoryTwoValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmGoodsPledgeCreateUpdateGoodsCategoryTwoTimeOut();

					function frmGoodsPledgeCreateUpdateGoodsCategoryThreeTimeOut() {
						setTimeout(function () {
							if (frmGoodsPledgeCreateUpdateGoodsCategoryThreeSetupCompleted == false){
								frmGoodsPledgeCreateUpdateGoodsCategoryThreeTimeOut();
							}
							else{
								if (data.goodsCategoryThree != null){
									goodsCategoryThreeSelectInput.value = data.goodsCategoryThree;
									var formGroupId = goodsCategoryThreeSelectInput.id.concat('FormGroup');
									$('#' + formGroupId).collapse('show');

								}
								else{
									goodsCategoryThreeSelectInput.value = -1;
									frmGoodsPledgeCreateUpdateGoodsCategoryThreeValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmGoodsPledgeCreateUpdateGoodsCategoryThreeTimeOut();

					function frmGoodsPledgeCreateUpdateGoodsSizeTimeOut() {
						setTimeout(function () {
							if (frmGoodsPledgeCreateUpdateGoodsSizeSetupCompleted == false){
								frmGoodsPledgeCreateUpdateGoodsSizeTimeOut();
							}
							else{
								if (data.goodsSize != null){
									goodsSizeSelectInput.value = data.goodsSize;
									var formGroupId = goodsSizeSelectInput.id.concat('FormGroup');
									$('#' + formGroupId).collapse('show');

								}
								else{
									goodsSizeSelectInput.value = -1;
									frmGoodsPledgeCreateUpdateGoodsSizeValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmGoodsPledgeCreateUpdateGoodsSizeTimeOut();

					function frmGoodsPledgeCreateUpdateGoodsNewOrUsedTimeOut() {
						setTimeout(function () {
							if (frmGoodsPledgeCreateUpdateGoodsNewOrUsedSetupCompleted == false){
								frmGoodsPledgeCreateUpdateGoodsNewOrUsedTimeOut();
							}
							else{
								if (data.goodsNewOrUsed != null){
									goodsNewOrUsedSelectInput.value = data.goodsNewOrUsed;
								}
								else{
									goodsNewOrUsedSelectInput.selectedIndex = 0;
									//frmGoodsPledgeCreateUpdateGoodsNewOrUsedValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmGoodsPledgeCreateUpdateGoodsNewOrUsedTimeOut();

					function frmGoodsPledgeCreateUpdateGoodsConditionTimeOut() {
						setTimeout(function () {
							if (frmGoodsPledgeCreateUpdateGoodsConditionSetupCompleted == false){
								frmGoodsPledgeCreateUpdateGoodsConditionTimeOut();
							}
							else{
								if (data.goodsCondition != null){
									goodsConditionSelectInput.value = data.goodsCondition;
									var formGroupId = goodsConditionSelectInput.id.concat('FormGroup');
									$('#' + formGroupId).collapse('show');

								}
								else{
									goodsConditionSelectInput.value = -1;
									frmGoodsPledgeCreateUpdateGoodsConditionValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmGoodsPledgeCreateUpdateGoodsConditionTimeOut();

					function frmGoodsPledgeCreateUpdateGoodsQuantityTimeOut() {
						setTimeout(function () {
							if (frmGoodsPledgeCreateUpdateGoodsQuantitySetupCompleted == false){
								frmGoodsPledgeCreateUpdateGoodsQuantityTimeOut();
							}
							else{
								if (data.goodsQuantity != null){
									goodsQuantitySelectInput.value = data.goodsQuantity;
									var formGroupId = goodsQuantitySelectInput.id.concat('FormGroup');
									$('#' + formGroupId).collapse('show');

								}
								else{
									goodsQuantitySelectInput.value = -1;
									frmGoodsPledgeCreateUpdateGoodsQuantityValueBuffer = -1;
								}
							}
						}, 100);
					}

					frmGoodsPledgeCreateUpdateGoodsQuantityTimeOut();

					modal.find('#frmGoodsPledgeCreateUpdateAdditionalInformation').val(data.additionalInformation);
					frmGoodsPledgeCreateUpdateAdditionalInformationBuffer = data.additionalInformation;

					modal.find('#frmGoodsPledgeCreateUpdateItemSize').val(data.itemSize);

					modal.find('#frmGoodsPledgeCreateUpdateGoodsDateFrom').val(data.dateAvailableFrom);
					modal.find('#frmGoodsPledgeCreateUpdateGoodsDateTo').val(data.dateAvailableTo);
					frmGoodsPledgeCreateUpdateItemSizeBuffer = data.itemSize;

					// Display a count of the characters in the Additional Information textarea input
					$('#frmGoodsPledgeCreateUpdateAdditionalInformationCountBlock').text($('#frmGoodsPledgeCreateUpdateAdditionalInformation').val().length.toString().concat('/').concat('500'));


				}
			});
		}


		// Display a count of the characters in the Additional Information textarea input
		$('#frmGoodsPledgeCreateUpdateAdditionalInformationCountBlock').text($('#frmGoodsPledgeCreateUpdateAdditionalInformation').val().length.toString().concat('/').concat('500'));


	});	

	$('#goodsPledgeCreateUpdateModal').on('shown.bs.modal', function (event) {
		if (frmGoodsPledgeCreateUpdateLaddaSubmitButtonHandler != null){
			frmGoodsPledgeCreateUpdateLaddaSubmitButtonHandler.stop();
		}
		$('#frmGoodsPledgeCreateUpdateGoodsCategoryOne').focus()
	});	






	$("#frmGoodsPledgeCreateUpdateSubmitButton").click(function( event ) {
		frmGoodsPledgeCreateUpdateLaddaSubmitButtonHandler.start();
		var validationSuccess = true;
		var mode = null;
		var modal = $('#goodsPledgeCreateUpdateModal');
		var modalTitle = modal.find('#frmGoodsPledgeCreateUpdateTitle').val();
		var callBackDisplayType = modal.find('#frmGoodsPledgeCreateUpdateCallBackDisplayType').val();

		$( modal.find("input[type=text], input[type=tel], input[type=email], input[type=checkbox][aria-describedby], textarea, select")).each(function(){
			var containerId = ('#').concat($(this).attr('id')).concat('FormGroup');
			var feedbackIconContainerId = ('#').concat($(this).attr('id')).concat('FeedbackIcon');
			var feedbackAlertBlockId = ('#').concat($(this).attr('id')).concat('AlertBlock');
			var feedbackAlertBlockTextId = ('#').concat($(this).attr('id')).concat('AlertBlockText');
			var feedbackHelpBlockId = ('#').concat($(this).attr('id')).concat('HelpBlock');

			if ($(this).data('required') == true){
				if ( ( !$(this).is(':checkbox') && ($(this).val() == -1 || $(this).val() == '') ) || ( $(this).is(':checkbox') && !$(this).is(':checked') ) ){
					if ($(this).is(':checkbox')){
						$(feedbackHelpBlockId).text('Please check the ' + $(this).data('display-name') + ' checkbox');
						//showalert(feedbackAlertBlockId, feedbackAlertBlockTextId, 'Please check the ' + $(this).data('display-name') + ' checkbox', 'alert-danger')    					
					}else{
						$(feedbackHelpBlockId).text('Please enter a value for ' + $(this).data('display-name'));
						//showalert(feedbackAlertBlockId, feedbackAlertBlockTextId, 'Please enter a value for ' + $(this).data('display-name'), 'alert-danger')
					}
					$(containerId).toggleClass('has-error', true);
					if (!$(this).is(':checkbox')){
						$(feedbackIconContainerId).toggleClass('glyphicon-remove', true);
					}
					validationSuccess = false;
				}
			}

		});

		if (validationSuccess == false){
			frmGoodsPledgeCreateUpdateLaddaSubmitButtonHandler.stop();
			return false;
		}


		if (modal.find('#frmGoodsPledgeCreateUpdateLoadedObjectId').val().length > 0){
			mode = "update";
		}
		else{
			mode="new";
		}


		var goodsPledge = {
				parentObjectId : modal.find('#frmGoodsPledgeCreateUpdateParentObjectId').val(),
				id : modal.find('#frmGoodsPledgeCreateUpdateLoadedObjectId').val(),
				goodsCategoryOne : modal.find('#frmGoodsPledgeCreateUpdateGoodsCategoryOne').val(),
				goodsCategoryTwo : modal.find('#frmGoodsPledgeCreateUpdateGoodsCategoryTwo').val(),
				goodsCategoryThree : modal.find('#frmGoodsPledgeCreateUpdateGoodsCategoryThree').val(),
				goodsSize : modal.find('#frmGoodsPledgeCreateUpdateGoodsSize').val(),
				goodsNewOrUsed : modal.find('#frmGoodsPledgeCreateUpdateGoodsNewOrUsed').val(),
				goodsCondition : modal.find('#frmGoodsPledgeCreateUpdateGoodsCondition').val(),
				goodsQuantity : modal.find('#frmGoodsPledgeCreateUpdateGoodsQuantity').val(),
				additionalInformation : modal.find('#frmGoodsPledgeCreateUpdateAdditionalInformation').val(),
				itemSize : modal.find('#frmGoodsPledgeCreateUpdateItemSize').val(),
				dateAvailableFrom: modal.find('#frmGoodsPledgeCreateUpdateGoodsDateFrom').val(),
				dateAvailableTo: modal.find('#frmGoodsPledgeCreateUpdateGoodsDateTo').val(),
		};

		var propertyUrl = modal.find('#frmGoodsPledgeCreateUpdatePropertyUrl').val();
		var url = rootContext + "/restful/registerofpledges/" + propertyUrl + "/" + mode;

		$.ajax({
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			method: "post",
			url: url,
			data: JSON.stringify(goodsPledge),
			success: function( data ) {
				if ( ($('#frmRegisterOfPledgesMode').val() == 'ADD') || ($('#frmRegisterOfPledgesMode').val() == 'UPDATE')){
					if (callBackDisplayType == "table"){
						var new_tbody = document.createElement('tbody');
						var callBackTableBodyId = modal.find('#frmGoodsPledgeCreateUpdateCallBackTableBodyId').val();
						var callBackTableBody = document.getElementById(callBackTableBodyId);

						$.each(data, function(idx, obj) {
							var row = document.createElement("tr");
							var cell = document.createElement("td");
							var editModalAnchorText = "<a href='#' class='btn btn-info btn-sm' data-toggle='modal' data-backdrop='static' data-target='#goodsPledgeCreateUpdateModal' data-id='" + obj.id + "' data-modal-title='" + modalTitle + "' data-callback-table-body-id='" + callBackTableBodyId + "' data-property-url='goodspledges' data-callback-display-type='table' aria-label='view'><span class='glyphicon glyphicon-edit'></a>";
							var editAnchorURI = rootContext + "/goodspledge/" + obj.id + "/update";
							var editAnchorText = "<a href='" + editAnchorURI + "' class='btn btn-primary btn-sm' aria-label='view'><span class='glyphicon glyphicon-pencil'></a>";
							cell.innerHTML = "<div class='btn-group-vertical' role='group'>" + editModalAnchorText  + "</div>";
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.goodsCategoryOneReferenceTranslation);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.goodsCategoryTwoReferenceTranslation);
							cell.appendChild(cellText);
							row.appendChild(cell);

							var cell = document.createElement("td");
							var cellText = document.createTextNode(obj.goodsCategoryThreeReferenceTranslation);
							cell.appendChild(cellText);
							row.appendChild(cell);

							new_tbody.appendChild(row);
						});

						callBackTableBody.parentNode.replaceChild(new_tbody, callBackTableBody);
						new_tbody.id = callBackTableBodyId;
					}
					else if (callBackDisplayType == "inline"){
						$.each(data, function(idx, obj) {

							document.getElementById("frmGoodsPledgeGoodsCategoryOneMessage").innerHTML = obj.goodsCategoryOneReferenceTranslation;

							document.getElementById("frmGoodsPledgeGoodsCategoryTwoMessage").innerHTML = obj.goodsCategoryTwoReferenceTranslation;

							document.getElementById("frmGoodsPledgeGoodsCategoryThreeMessage").innerHTML = obj.goodsCategoryThreeReferenceTranslation;

						});
					}
				}

				modal.modal('hide');
			},
			error: function(jqXHR, textStatus, errorThrown) {
				if(jqXHR.status==403) {
					alert('403 returned');
				}

				console.log(textStatus, errorThrown);
			}
		});
	});


	$("#frmGoodsPledgeCreateUpdateCloseButton").click(function( event ) {
		var mode = null;
		var modal = $('#goodsPledgeCreateUpdateModal');
		var callBackTableBodyId = modal.find('#frmGoodsPledgeCreateUpdateCallBackTableBodyId').val();
		var callBackTableBody = document.getElementById(callBackTableBodyId);
		var modalTitle = modal.find('#frmGoodsPledgeCreateUpdateTitle').val();


		modal.modal('hide');
	});




	if ($('#frmRegisterOfPledgesMode').val() == 'LOCALIZE'){
		$('#existingLocale').change(function () {
			var selectedLocale = $('#existingLocale option:selected').val();
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/view/messageresource/list",
				data: {
					id: $('#frmRegisterOfPledgesRegisterOfPledgesViewId').val()
				},
				success: function( data ) {
					$.each(data, function(idx, obj) {
						//alert(obj.messageKey.substr(-6));
						try{
							if ( ((obj.messageKey.substr(-12) == '.form.header') || (obj.messageKey.substr(-15) == '.form.subheader') || (obj.messageKey.substr(-11) == '.form.title')) && obj.localeReferenceId == selectedLocale){
								//alert('Setting Page Header Title: ' + obj.messageKey + ' with value: ' + obj.message);
								document.getElementById(obj.messageKey + '.localizer.label').innerHTML = obj.message;
							}
							else if ((obj.messageKey.substr(-5) == 'Label') && obj.localeReferenceId == selectedLocale){
								//alert('Setting Label: ' + obj.messageKey + ' with value: ' + obj.message);

								document.getElementById(obj.messageKey).innerHTML = obj.message;
								document.getElementById(obj.messageKey + 'LocalizerLabel').innerHTML = obj.message;
							}
							else if ((obj.messageKey.substr(-7) == 'Message') && obj.localeReferenceId == selectedLocale){
								//alert('Setting Message: ' + obj.messageKey + ' with value: ' + obj.message);

								document.getElementById(obj.messageKey).innerHTML = obj.message;
								document.getElementById(obj.messageKey + 'LocalizerLabel').innerHTML = obj.message;
							}
							else if ((obj.messageKey.substr(-9) == 'HelpBlock') && obj.localeReferenceId == selectedLocale){
								//alert('Setting HelpBlock: ' + obj.messageKey + ' with value: ' + obj.message);

								document.getElementById(obj.messageKey).innerHTML = obj.message;
								document.getElementById(obj.messageKey + 'LocalizerLabel').innerHTML = obj.message;
							}
							else if ((obj.messageKey.substr(-11) == 'PlaceHolder') && obj.localeReferenceId == selectedLocale){
								//alert('Setting PlaceHolder: ' + obj.messageKey + ' with value: ' + obj.message);
								var inputId = obj.messageKey.replace('PlaceHolder', '');

								var elementReference = document.getElementById(inputId);
								if (elementReference.type == 'select-one' || elementReference.type == 'select-multiple'){
									removeSelectOptions(elementReference);
									$.ajax({
										dataType: "json",
										url: rootContext + "/restful/referenceslist",
										data: {
											referenceType: elementReference.getAttribute("data-reference-type")
										},
										success: function( data ) {
											var unselectedOption = document.createElement("option");
											unselectedOption.value = -1;
											unselectedOption.textContent = obj.message;
											elementReference.appendChild(unselectedOption);

											$.each( data, function( key, val ) {
												var el = document.createElement("option");
												el.textContent = val;
												el.value = key;

												elementReference.appendChild(el);
											});
										}
									});
								}

								document.getElementById(inputId).placeholder = obj.message;
								document.getElementById(obj.messageKey + 'LocalizerLabel').innerHTML = obj.message;
							}

						}catch(ex){
							//alert('Found a messageKey with no matching inputs: ' + obj.messageKey);
						}
					});
				}
			});

		});

		// Fire the existingLocale changed event to load the default locale messages via AJAX
		var existingLocaleChangeEvent = document.createEvent("HTMLEvents");
		existingLocaleChangeEvent.initEvent("change", false, true);
		var existingLocaleSelectInput = document.getElementById("existingLocale");
		existingLocaleSelectInput.dispatchEvent(existingLocaleChangeEvent);

		$('#newLocale').change(function () {
			var selectedLocale = $('#newLocale option:selected').val();
			$.ajax({
				dataType: "json",
				url: rootContext + "/restful/view/messageresource/list",
				data: {
					id: $('#frmRegisterOfPledgesRegisterOfPledgesViewId').val()
				},
				success: function( data ) {
					$.each(data, function(idx, obj) {
						try{
							//alert(obj.messageKey.substr(-6));
							if ( ((obj.messageKey.substr(-12) == '.form.header') || (obj.messageKey.substr(-15) == '.form.subheader') || (obj.messageKey.substr(-11) == '.form.title') ) && obj.localeReferenceId == selectedLocale){
								//alert('Setting PageHeaderTitle: ' + obj.messageKey + ' with value: ' + obj.message);

								document.getElementById(obj.messageKey + '.localizer.input').value = obj.message;
							}
							else if ((obj.messageKey.substr(-5) == 'Label') && obj.localeReferenceId == selectedLocale){
								//alert('Setting Label: ' + obj.messageKey + ' with value: ' + obj.message);

								document.getElementById(obj.messageKey + 'Localizer').value = obj.message;
							}
							else if ((obj.messageKey.substr(-7) == 'Message') && obj.localeReferenceId == selectedLocale){
								//alert('Setting Message: ' + obj.messageKey + ' with value: ' + obj.message);

								document.getElementById(obj.messageKey + 'Localizer').value = obj.message;
							}
							else if ((obj.messageKey.substr(-9) == 'HelpBlock') && obj.localeReferenceId == selectedLocale){
								//alert('Setting HelpBlock: ' + obj.messageKey + ' with value: ' + obj.message);

								document.getElementById(obj.messageKey + 'Localizer').value = obj.message;
							}
							else if ((obj.messageKey.substr(-11) == 'PlaceHolder') && obj.localeReferenceId == selectedLocale){
								//alert('Setting PlaceHolder: ' + obj.messageKey + ' with value: ' + obj.message);
								document.getElementById(obj.messageKey + 'Localizer').value = obj.message;
							}
						}catch(ex){
							//alert('Found a messageKey with no matching inputs: ' + obj.messageKey);
						}
					});
				}
			});

		});

		// Fire the newLocale changed event to load the default locale messages via AJAX
		var newLocaleChangeEvent = document.createEvent("HTMLEvents");
		newLocaleChangeEvent.initEvent("change", false, true);
		var newLocaleSelectInput = document.getElementById("newLocale");
		newLocaleSelectInput.dispatchEvent(newLocaleChangeEvent);
	} // end if ($('#frmRegisterOfPledgesMode').val() == 'LOCALIZE')

	$('#frmApplicationUserDetailsCreateUpdateCountry').val("159");
	$('#frmApplicationUserDetailsCreateUpdateCountry').prop('disabled', 'disabled');

});// end of document.ready line (133)


/**
 * Called when the exitButton is clicked
 */
function frmRegisterOfPledgesExitButtonClicked(){
	var changedCounter = 0;
	var returnValue = false;
	var focusSet = false;
	var focusControl;


	if (changedCounter > 0){

		BootstrapDialog.confirm({
			title: 'WARNING',
			message: 'Warning! You are exiting without saving your work. Exit without saving?',
			type: BootstrapDialog.TYPE_WARNING, // <-- Default value is BootstrapDialog.TYPE_PRIMARY
			closable: false, // <-- Default value is false
			draggable: true, // <-- Default value is false
			btnCancelLabel: 'Review my changes!', // <-- Default value is 'Cancel',
			btnOKLabel: 'Exit without saving!', // <-- Default value is 'OK',
			btnOKClass: 'btn-warning', // <-- If you didn't specify it, dialog type will be used,
			callback: function(result) {
				// result will be true if button was click, while it will be false if users close the dialog directly.
				if(result) {
					document.getElementById("frmRegisterOfPledges").method = "get";
					document.getElementById("frmRegisterOfPledges").submit();
				}else {
					returnValue = false;
				}
			}
		});

	}
	else{
		document.getElementById("frmRegisterOfPledges").method = "get";
		document.getElementById("frmRegisterOfPledges").submit();
	}

	if (focusSet == true){
		focusControl.focus();
	}

	return returnValue;
}

